{"module":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","blessed":[],"interfaces":[],"imports":[{"hash":null,"imports":null,"module":{"namespace":null,"name":"system"},"i":{"d":[16,"golden/golden.accounts.repl",28,2,885,2],"c":"(use system)\n\n  "}}],"name":{"namespace":null,"name":"accounts"},"code":"(module accounts 'accounts-admin-keyset\n  \"Accounts module demonstrating row-level keysets, private pacts, and escrow. \\\n\\  Version: 0.2                                                                \\\n\\  Author: Stuart Popejoy\"\n\n  ;; mock preview of system library with get-system-time\n  (use system)\n\n  (defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  (deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  (defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  (defcap TRANSFER () true)\n\n  (defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  (defcap PAY (sender:string receiver:string amount:decimal)\n    \"Demonstrates managed signature capabilities\"\n    @managed amount manage-PAY\n    (compose-capability (USER_GUARD sender)))\n\n  (defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  (defun pay (sender:string receiver:string amount:decimal date)\n    \"Demonstrate managed capability PAY\"\n    (with-capability (PAY sender receiver amount)\n                     (transfer sender receiver amount date)))\n\n  (defun create-account (address guard ccy date)\n    (with-capability (ADMIN)\n      (insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    )))\n\n  (defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  (defun read-account-user (id)\n    \"Read data for account ID\"\n    (with-capability (USER_GUARD id)\n      (with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })))\n\n\n  (defun read-account-admin (id)\n    \"Read data for account ID, admin version\"\n    (with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])))\n\n\n  (defun account-keys ()\n    \"Get all account keys\"\n    (with-capability (ADMIN)\n      (keys accounts)))\n\n  (defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  (defun fund-account (address amount date)\n    (with-capability (ADMIN)\n      (update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      )))\n\n  (defun read-all ()\n    (with-capability (ADMIN)\n      (map (read-account-admin) (keys accounts))))\n\n  (defpact payment (payer payer-entity payee payee-entity amount date)\n    \"Debit PAYER at PAYER-ENTITY then credit PAYEE at PAYEE-ENTITY for AMOUNT on DATE\"\n    (step-with-rollback payer-entity\n      (with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      (with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })))\n\n    (step payee-entity\n      (with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })))\n  )\n\n\n  (defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n (defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  (defconst ESCROW_ACCT \"escrow-account\")\n\n  (defpact two-party-escrow (deb-acct cred-acct\n                             escrow-amount:decimal timeout)\n    \"Simple two-party escrow pact\"\n    (step-with-rollback\n      (init-escrow deb-acct escrow-amount)\n      (cancel-escrow timeout deb-acct cred-acct escrow-amount))\n    (step\n      (finish-escrow deb-acct cred-acct\n                     escrow-amount)))\n\n\n  (defun init-escrow (deb-acct amount)\n    ;; transfer will handle deb-keyset enforce\n    (with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))))\n\n  (defun cancel-escrow (timeout deb-acct cred-acct amount)\n    (with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))))\n\n\n  (defun finish-escrow (deb-acct cred-acct\n                        escrow-amount:decimal)\n    (with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))))\n\n\n  (defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  (defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  (defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n)\n\n","meta":{"model":[],"docs":"Accounts module demonstrating row-level keysets, private pacts, and escrow.   Version: 0.2                                                                  Author: Stuart Popejoy"},"governance":{"keyset":"accounts-admin-keyset"}},"refMap":{"cancel-escrow":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"timeout","type":{"tag":"TypeVar","name":"bp","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",197,24,5885,24],"c":"timeout "}},{"name":"deb-acct","type":{"tag":"TypeVar","name":"bq","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",197,32,5893,32],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"br","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",197,41,5902,41],"c":"cred-acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"bs","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",197,51,5912,51],"c":"amount"}}],"return":{"tag":"TypeVar","name":"bo","constraint":[]}},"defName":"cancel-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",198,36,5956,36],"c":"deb-acct "}},{"var":{"b":2},"i":{"d":[10,"golden/golden.accounts.repl",198,45,5965,45],"c":"cred-acct "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",198,55,5975,55],"c":"timeout"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"cb","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",218,25,6788,25],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"cc","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",218,34,6797,34],"c":"cred-acct "}},{"name":"timeout","type":{"tag":"TypeVar","name":"cd","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",218,44,6807,44],"c":"timeout"}}],"return":{"tag":"TypeVar","name":"ca","constraint":[]}},"defName":"CANCEL-ESCROW","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"i":{"d":[76,"golden/golden.accounts.repl",222,8,6965,8],"c":"\"Cancel can only be effected by creditor, or debitor after timeout\"\n        "},"lit":"Cancel can only be effected by creditor, or debitor after timeout"},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",223,41,7074,41],"c":"cred-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",223,30,7063,30],"c":"USER_GUARD "}},"info":{"d":[22,"golden/golden.accounts.repl",223,29,7062,29],"c":"(USER_GUARD cred-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",223,10,7043,10],"c":"compose-capability "}},"info":{"d":[53,"golden/golden.accounts.repl",223,9,7042,9],"c":"(compose-capability (USER_GUARD cred-acct))\n         "}},{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",224,46,7132,46],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",224,35,7121,35],"c":"USER_GUARD "}},"info":{"d":[21,"golden/golden.accounts.repl",224,34,7120,34],"c":"(USER_GUARD deb-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",224,15,7101,15],"c":"compose-capability "}},"info":{"d":[57,"golden/golden.accounts.repl",224,14,7100,14],"c":"(compose-capability (USER_GUARD deb-acct))\n              "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",225,27,7170,27],"c":"systime "}},{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",225,35,7178,35],"c":"timeout"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",225,24,7167,24],"c":">= "}},"info":{"d":[21,"golden/golden.accounts.repl",225,23,7166,23],"c":"(>= systime timeout) "}},{"i":{"d":[47,"golden/golden.accounts.repl",225,44,7187,44],"c":"\"Cancel timeout not expired for debitor cancel\""},"lit":"Cancel timeout not expired for debitor cancel"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",225,15,7158,15],"c":"enforce "}},"info":{"d":[78,"golden/golden.accounts.repl",225,14,7157,14],"c":"(enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\")"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"and"}},"i":null}},"i":null}},"i":{"d":[4,"golden/golden.accounts.repl",224,10,7096,10],"c":"and "}},"info":{"d":[150,"golden/golden.accounts.repl",224,9,7095,9],"c":"(and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        "}}],"type":{"tag":"TypeVar","name":"cf","constraint":[]},"i":{"d":[205,"golden/golden.accounts.repl",223,8,7041,8],"c":"[(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-one"}},"i":null}},"i":null}},"i":{"d":[20,"golden/golden.accounts.repl",221,7,6945,7],"c":"enforce-one\n        "}},"info":{"d":[303,"golden/golden.accounts.repl",221,6,6944,6],"c":"(enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])"}}],"type":"*","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}},"pairs":[{"arg":{"name":"systime","type":{"tag":"TypeVar","name":"ce","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",220,11,6910,11],"c":"systime "}},"val":{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",220,20,6919,20],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",220,19,6918,19],"c":"(get-system-time)"}}}],"type":"let","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}],"type":"*","i":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT"},"info":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",198,22,5942,22],"c":"CANCEL-ESCROW "}},"info":{"d":[49,"golden/golden.accounts.repl",198,21,5941,21],"c":"(CANCEL-ESCROW deb-acct cred-acct timeout)\n      "}},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",199,34,6018,34],"c":"ESCROW_ACCT"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",199,17,6001,17],"c":"get-pact-account "}},"info":{"d":[31,"golden/golden.accounts.repl",199,16,6000,16],"c":"(get-pact-account ESCROW_ACCT) "}},{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",199,47,6031,47],"c":"deb-acct "}},{"var":{"b":3},"i":{"d":[7,"golden/golden.accounts.repl",199,56,6040,56],"c":"amount "}},{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",199,64,6048,64],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",199,63,6047,63],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",199,7,5991,7],"c":"transfer "}},"info":{"d":[75,"golden/golden.accounts.repl",199,6,5990,6],"c":"(transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))"}}],"type":"*","i":{"d":[75,"golden/golden.accounts.repl",199,6,5990,6],"c":"(transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",198,5,5925,5],"c":"with-capability "}},"info":{"d":[142,"golden/golden.accounts.repl",198,4,5924,4],"c":"(with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time)))"}}],"type":"*","i":{"d":[209,"golden/golden.accounts.repl",197,2,5863,2],"c":"(defun cancel-escrow (timeout deb-acct cred-acct amount)\n    (with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[209,"golden/golden.accounts.repl",197,2,5863,2],"c":"(defun cancel-escrow (timeout deb-acct cred-acct amount)\n    (with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))))\n\n\n  "}}},"read-account-admin":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"aa","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",97,29,2795,29],"c":"id"}}],"return":{"tag":"TypeVar","name":"z","constraint":[]}},"defName":"read-account-admin","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",99,22,2867,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",99,21,2866,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",100,12,2886,12],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",100,21,2895,21],"c":"id "}},{"list":[{"i":{"d":[9,"golden/golden.accounts.repl",100,25,2899,25],"c":"'balance "},"lit":"balance"},{"i":{"d":[5,"golden/golden.accounts.repl",100,34,2908,34],"c":"'ccy "},"lit":"ccy"},{"i":{"d":[10,"golden/golden.accounts.repl",100,39,2913,39],"c":"'rowguard "},"lit":"rowguard"},{"i":{"d":[6,"golden/golden.accounts.repl",100,49,2923,49],"c":"'data "},"lit":"data"},{"i":{"d":[6,"golden/golden.accounts.repl",100,55,2929,55],"c":"'date "},"lit":"date"},{"i":{"d":[7,"golden/golden.accounts.repl",100,61,2935,61],"c":"'amount"},"lit":"amount"}],"type":{"tag":"TypeVar","name":"ab","constraint":[]},"i":{"d":[45,"golden/golden.accounts.repl",100,24,2898,24],"c":"['balance 'ccy 'rowguard 'data 'date 'amount]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",100,7,2881,7],"c":"read "}},"info":{"d":[64,"golden/golden.accounts.repl",100,6,2880,6],"c":"(read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])"}}],"type":"*","i":{"d":[64,"golden/golden.accounts.repl",100,6,2880,6],"c":"(read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",99,5,2850,5],"c":"with-capability "}},"info":{"d":[96,"golden/golden.accounts.repl",99,4,2849,4],"c":"(with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount]))"}}],"type":"*","i":{"d":[183,"golden/golden.accounts.repl",97,2,2768,2],"c":"(defun read-account-admin (id)\n    \"Read data for account ID, admin version\"\n    (with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Read data for account ID, admin version"},"info":{"d":[183,"golden/golden.accounts.repl",97,2,2768,2],"c":"(defun read-account-admin (id)\n    \"Read data for account ID, admin version\"\n    (with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])))\n\n\n  "}}},"CANCEL-ESCROW":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"cb","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",218,25,6788,25],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"cc","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",218,34,6797,34],"c":"cred-acct "}},{"name":"timeout","type":{"tag":"TypeVar","name":"cd","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",218,44,6807,44],"c":"timeout"}}],"return":{"tag":"TypeVar","name":"ca","constraint":[]}},"defName":"CANCEL-ESCROW","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"i":{"d":[76,"golden/golden.accounts.repl",222,8,6965,8],"c":"\"Cancel can only be effected by creditor, or debitor after timeout\"\n        "},"lit":"Cancel can only be effected by creditor, or debitor after timeout"},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",223,41,7074,41],"c":"cred-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",223,30,7063,30],"c":"USER_GUARD "}},"info":{"d":[22,"golden/golden.accounts.repl",223,29,7062,29],"c":"(USER_GUARD cred-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",223,10,7043,10],"c":"compose-capability "}},"info":{"d":[53,"golden/golden.accounts.repl",223,9,7042,9],"c":"(compose-capability (USER_GUARD cred-acct))\n         "}},{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",224,46,7132,46],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",224,35,7121,35],"c":"USER_GUARD "}},"info":{"d":[21,"golden/golden.accounts.repl",224,34,7120,34],"c":"(USER_GUARD deb-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",224,15,7101,15],"c":"compose-capability "}},"info":{"d":[57,"golden/golden.accounts.repl",224,14,7100,14],"c":"(compose-capability (USER_GUARD deb-acct))\n              "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",225,27,7170,27],"c":"systime "}},{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",225,35,7178,35],"c":"timeout"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",225,24,7167,24],"c":">= "}},"info":{"d":[21,"golden/golden.accounts.repl",225,23,7166,23],"c":"(>= systime timeout) "}},{"i":{"d":[47,"golden/golden.accounts.repl",225,44,7187,44],"c":"\"Cancel timeout not expired for debitor cancel\""},"lit":"Cancel timeout not expired for debitor cancel"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",225,15,7158,15],"c":"enforce "}},"info":{"d":[78,"golden/golden.accounts.repl",225,14,7157,14],"c":"(enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\")"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"and"}},"i":null}},"i":null}},"i":{"d":[4,"golden/golden.accounts.repl",224,10,7096,10],"c":"and "}},"info":{"d":[150,"golden/golden.accounts.repl",224,9,7095,9],"c":"(and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        "}}],"type":{"tag":"TypeVar","name":"cf","constraint":[]},"i":{"d":[205,"golden/golden.accounts.repl",223,8,7041,8],"c":"[(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-one"}},"i":null}},"i":null}},"i":{"d":[20,"golden/golden.accounts.repl",221,7,6945,7],"c":"enforce-one\n        "}},"info":{"d":[303,"golden/golden.accounts.repl",221,6,6944,6],"c":"(enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])"}}],"type":"*","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}},"pairs":[{"arg":{"name":"systime","type":{"tag":"TypeVar","name":"ce","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",220,11,6910,11],"c":"systime "}},"val":{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",220,20,6919,20],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",220,19,6918,19],"c":"(get-system-time)"}}}],"type":"let","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}],"type":"*","i":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT"},"info":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"ADMIN":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"payment":{"ref":{"defType":"Defpact","defMeta":null,"funType":{"args":[{"name":"payer","type":{"tag":"TypeVar","name":"am","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",124,20,3547,20],"c":"payer "}},{"name":"payer-entity","type":{"tag":"TypeVar","name":"an","constraint":[]},"info":{"d":[13,"golden/golden.accounts.repl",124,26,3553,26],"c":"payer-entity "}},{"name":"payee","type":{"tag":"TypeVar","name":"ao","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",124,39,3566,39],"c":"payee "}},{"name":"payee-entity","type":{"tag":"TypeVar","name":"ap","constraint":[]},"info":{"d":[13,"golden/golden.accounts.repl",124,45,3572,45],"c":"payee-entity "}},{"name":"amount","type":{"tag":"TypeVar","name":"aq","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",124,58,3585,58],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"ar","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",124,65,3592,65],"c":"date"}}],"return":{"tag":"TypeVar","name":"al","constraint":[]}},"defName":"payment","defBody":{"scope":{"list":[{"body":{"exec":{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",127,24,3746,24],"c":"TRANSFER"}},"info":{"d":[19,"golden/golden.accounts.repl",127,23,3745,23],"c":"(TRANSFER)\n        "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[6,"golden/golden.accounts.repl",128,15,3771,15],"c":"payer "}},{"var":{"b":4},"i":{"d":[7,"golden/golden.accounts.repl",128,21,3777,21],"c":"amount "}},{"var":{"b":5},"i":{"d":[15,"golden/golden.accounts.repl",128,28,3784,28],"c":"date\n          "}},{"obj":{"payee":{"var":{"b":2},"i":{"d":[16,"golden/golden.accounts.repl",129,21,3810,21],"c":"payee\n          "}},"payee-entity":{"var":{"b":3},"i":{"d":[23,"golden/golden.accounts.repl",130,28,3844,28],"c":"payee-entity\n          "}},"ref":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",131,20,3877,20],"c":"pact-id"}},"info":{"d":[20,"golden/golden.accounts.repl",131,19,3876,19],"c":"(pact-id)\n          "}}},"keyorder":["payee","payee-entity","ref"],"type":"*","i":{"d":[98,"golden/golden.accounts.repl",129,10,3799,10],"c":"{ \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",128,9,3765,9],"c":"debit "}},"info":{"d":[134,"golden/golden.accounts.repl",128,8,3764,8],"c":"(debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          })"}}],"type":"*","i":{"d":[134,"golden/golden.accounts.repl",128,8,3764,8],"c":"(debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          })"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",127,7,3729,7],"c":"with-capability "}},"info":{"d":[178,"golden/golden.accounts.repl",127,6,3728,6],"c":"(with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      "}},"rollback":{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",133,24,3924,24],"c":"TRANSFER"}},"info":{"d":[19,"golden/golden.accounts.repl",133,23,3923,23],"c":"(TRANSFER)\n        "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[6,"golden/golden.accounts.repl",134,16,3950,16],"c":"payer "}},{"var":{"b":4},"i":{"d":[7,"golden/golden.accounts.repl",134,22,3956,22],"c":"amount "}},{"var":{"b":5},"i":{"d":[15,"golden/golden.accounts.repl",134,29,3963,29],"c":"date\n          "}},{"obj":{"note":{"i":{"d":[11,"golden/golden.accounts.repl",135,38,4006,38],"c":"\"rollback\" "},"lit":"rollback"},"ref":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",135,20,3988,20],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",135,19,3987,19],"c":"(pact-id)"}}},"keyorder":["ref","note"],"type":"*","i":{"d":[40,"golden/golden.accounts.repl",135,10,3978,10],"c":"{ \"ref\": (pact-id), \"note\": \"rollback\" }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",134,9,3943,9],"c":"credit "}},"info":{"d":[77,"golden/golden.accounts.repl",134,8,3942,8],"c":"(credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })"}}],"type":"*","i":{"d":[77,"golden/golden.accounts.repl",134,8,3942,8],"c":"(credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",133,7,3907,7],"c":"with-capability "}},"info":{"d":[114,"golden/golden.accounts.repl",133,6,3906,6],"c":"(with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" }))"}},"entity":{"var":{"b":1},"i":{"d":[19,"golden/golden.accounts.repl",126,24,3709,24],"c":"payer-entity\n      "}},"info":{"d":[338,"golden/golden.accounts.repl",126,4,3689,4],"c":"(step-with-rollback payer-entity\n      (with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      (with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })))\n\n    "}},"meta":{"model":[],"docs":null},"i":{"d":[338,"golden/golden.accounts.repl",126,4,3689,4],"c":"(step-with-rollback payer-entity\n      (with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      (with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })))\n\n    "}},{"body":{"exec":{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",138,24,4070,24],"c":"TRANSFER"}},"info":{"d":[19,"golden/golden.accounts.repl",138,23,4069,23],"c":"(TRANSFER)\n        "}},{"list":[{"args":[{"var":{"b":2},"i":{"d":[6,"golden/golden.accounts.repl",139,16,4096,16],"c":"payee "}},{"var":{"b":4},"i":{"d":[7,"golden/golden.accounts.repl",139,22,4102,22],"c":"amount "}},{"var":{"b":5},"i":{"d":[15,"golden/golden.accounts.repl",139,29,4109,29],"c":"date\n          "}},{"obj":{"payer":{"var":{"b":0},"i":{"d":[16,"golden/golden.accounts.repl",140,21,4135,21],"c":"payer\n          "}},"payer-entity":{"var":{"b":1},"i":{"d":[23,"golden/golden.accounts.repl",141,28,4169,28],"c":"payer-entity\n          "}},"ref":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",142,20,4202,20],"c":"pact-id"}},"info":{"d":[20,"golden/golden.accounts.repl",142,19,4201,19],"c":"(pact-id)\n          "}}},"keyorder":["payer","payer-entity","ref"],"type":"*","i":{"d":[98,"golden/golden.accounts.repl",140,10,4124,10],"c":"{ \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",139,9,4089,9],"c":"credit "}},"info":{"d":[135,"golden/golden.accounts.repl",139,8,4088,8],"c":"(credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })"}}],"type":"*","i":{"d":[135,"golden/golden.accounts.repl",139,8,4088,8],"c":"(credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",138,7,4053,7],"c":"with-capability "}},"info":{"d":[172,"golden/golden.accounts.repl",138,6,4052,6],"c":"(with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          }))"}},"rollback":null,"entity":{"var":{"b":3},"i":{"d":[19,"golden/golden.accounts.repl",137,10,4033,10],"c":"payee-entity\n      "}},"info":{"d":[201,"golden/golden.accounts.repl",137,4,4027,4],"c":"(step payee-entity\n      (with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })))\n  "}},"meta":{"model":[],"docs":null},"i":{"d":[201,"golden/golden.accounts.repl",137,4,4027,4],"c":"(step payee-entity\n      (with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })))\n  "}}],"type":"*","i":{"d":[705,"golden/golden.accounts.repl",124,2,3529,2],"c":"(defpact payment (payer payer-entity payee payee-entity amount date)\n    \"Debit PAYER at PAYER-ENTITY then credit PAYEE at PAYEE-ENTITY for AMOUNT on DATE\"\n    (step-with-rollback payer-entity\n      (with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      (with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })))\n\n    (step payee-entity\n      (with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })))\n  )\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit PAYER at PAYER-ENTITY then credit PAYEE at PAYEE-ENTITY for AMOUNT on DATE"},"info":{"d":[705,"golden/golden.accounts.repl",124,2,3529,2],"c":"(defpact payment (payer payer-entity payee payee-entity amount date)\n    \"Debit PAYER at PAYER-ENTITY then credit PAYEE at PAYEE-ENTITY for AMOUNT on DATE\"\n    (step-with-rollback payer-entity\n      (with-capability (TRANSFER)\n        (debit payer amount date\n          { \"payee\": payee\n          , \"payee-entity\": payee-entity\n          , \"ref\": (pact-id)\n          }))\n      (with-capability (TRANSFER)\n        (credit payer amount date\n          { \"ref\": (pact-id), \"note\": \"rollback\" })))\n\n    (step payee-entity\n      (with-capability (TRANSFER)\n        (credit payee amount date\n          { \"payer\": payer\n          , \"payer-entity\": payer-entity\n          , \"ref\": (pact-id)\n          })))\n  )\n\n\n  "}}},"accounts":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"fund-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"address","type":{"tag":"TypeVar","name":"ah","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",111,23,3175,23],"c":"address "}},{"name":"amount","type":{"tag":"TypeVar","name":"ai","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",111,31,3183,31],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"aj","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",111,38,3190,38],"c":"date"}}],"return":{"tag":"TypeVar","name":"ag","constraint":[]}},"defName":"fund-account","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",112,22,3218,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",112,21,3217,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",113,14,3239,14],"c":"accounts "}},{"var":{"b":0},"i":{"d":[22,"golden/golden.accounts.repl",113,23,3248,23],"c":"address\n              "}},{"obj":{"amount":{"var":{"b":1},"i":{"d":[21,"golden/golden.accounts.repl",115,26,3316,26],"c":"amount\n              "}},"data":{"obj":{"note":{"i":{"d":[24,"golden/golden.accounts.repl",117,34,3386,34],"c":"\"Admin account funding\" "},"lit":"Admin account funding"}},"keyorder":["note"],"type":"*","i":{"d":[36,"golden/golden.accounts.repl",117,24,3376,24],"c":"{ \"note\": \"Admin account funding\" } "}},"balance":{"var":{"b":1},"i":{"d":[21,"golden/golden.accounts.repl",114,27,3283,27],"c":"amount\n              "}},"date":{"var":{"b":2},"i":{"d":[19,"golden/golden.accounts.repl",116,24,3347,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[150,"golden/golden.accounts.repl",114,14,3270,14],"c":"{ \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",113,7,3232,7],"c":"update "}},"info":{"d":[190,"golden/golden.accounts.repl",113,6,3231,6],"c":"(update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      )"}}],"type":"*","i":{"d":[190,"golden/golden.accounts.repl",113,6,3231,6],"c":"(update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      )"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",112,5,3201,5],"c":"with-capability "}},"info":{"d":[222,"golden/golden.accounts.repl",112,4,3200,4],"c":"(with-capability (ADMIN)\n      (update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      ))"}}],"type":"*","i":{"d":[273,"golden/golden.accounts.repl",111,2,3154,2],"c":"(defun fund-account (address amount date)\n    (with-capability (ADMIN)\n      (update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      )))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[273,"golden/golden.accounts.repl",111,2,3154,2],"c":"(defun fund-account (address amount date)\n    (with-capability (ADMIN)\n      (update accounts address\n              { \"balance\": amount\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": { \"note\": \"Admin account funding\" } }\n      )))\n\n  "}}},"pay":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,"golden/golden.accounts.repl",64,14,1794,14],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,"golden/golden.accounts.repl",64,28,1808,28],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",64,44,1824,44],"c":"amount"}},{"name":"date","type":{"tag":"TypeVar","name":"k","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",64,59,1839,59],"c":"date"}}],"return":{"tag":"TypeVar","name":"j","constraint":[]}},"defName":"pay","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",66,26,1912,26],"c":"sender "}},{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",66,33,1919,33],"c":"receiver "}},{"var":{"b":2},"i":{"d":[6,"golden/golden.accounts.repl",66,42,1928,42],"c":"amount"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"mgd","type":{"tag":"TypeVar","name":"h","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,21,1556,21],"c":"mgd "}},{"name":"recd","type":{"tag":"TypeVar","name":"i","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,25,1560,25],"c":"recd"}}],"return":{"tag":"TypeVar","name":"g","constraint":[]}},"defName":"manage-PAY","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",61,19,1734,19],"c":"bal "}},{"i":{"d":[3,"golden/golden.accounts.repl",61,23,1738,23],"c":"0.0"},"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",61,16,1731,16],"c":">= "}},"info":{"d":[13,"golden/golden.accounts.repl",61,15,1730,15],"c":"(>= bal 0.0) "}},{"i":{"d":[22,"golden/golden.accounts.repl",61,28,1743,28],"c":"\"insufficient balance\""},"lit":"insufficient balance"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",61,7,1722,7],"c":"enforce "}},"info":{"d":[52,"golden/golden.accounts.repl",61,6,1721,6],"c":"(enforce (>= bal 0.0) \"insufficient balance\")\n      "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",62,6,1773,6],"c":"bal"}}],"type":"*","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}},"pairs":[{"arg":{"name":"bal","type":"decimal","info":{"d":[3,"golden/golden.accounts.repl",60,11,1688,11],"c":"bal"}},"val":{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",60,26,1703,26],"c":"mgd "}},{"var":{"b":1},"i":{"d":[4,"golden/golden.accounts.repl",60,30,1707,30],"c":"recd"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",60,24,1701,24],"c":"- "}},"info":{"d":[12,"golden/golden.accounts.repl",60,23,1700,23],"c":"(- mgd recd)"}}}],"type":"let","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}],"type":"*","i":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrates managed caps, enforces linear constraint on amount."},"info":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"i":{"d":[15,"golden/golden.accounts.repl",54,20,1477,20],"c":"manage-PAY\n    "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,"golden/golden.accounts.repl",52,15,1361,15],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,"golden/golden.accounts.repl",52,29,1375,29],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",52,45,1391,45],"c":"amount"}}],"return":{"tag":"TypeVar","name":"f","constraint":[]}},"defName":"PAY","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[6,"golden/golden.accounts.repl",55,36,1524,36],"c":"sender"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",55,25,1513,25],"c":"USER_GUARD "}},"info":{"d":[19,"golden/golden.accounts.repl",55,24,1512,24],"c":"(USER_GUARD sender)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",55,5,1493,5],"c":"compose-capability "}},"info":{"d":[40,"golden/golden.accounts.repl",55,4,1492,4],"c":"(compose-capability (USER_GUARD sender))"}}],"type":"*","i":{"d":[189,"golden/golden.accounts.repl",52,2,1348,2],"c":"(defcap PAY (sender:string receiver:string amount:decimal)\n    \"Demonstrates managed signature capabilities\"\n    @managed amount manage-PAY\n    (compose-capability (USER_GUARD sender)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrates managed signature capabilities"},"info":{"d":[189,"golden/golden.accounts.repl",52,2,1348,2],"c":"(defcap PAY (sender:string receiver:string amount:decimal)\n    \"Demonstrates managed signature capabilities\"\n    @managed amount manage-PAY\n    (compose-capability (USER_GUARD sender)))\n\n  "}}},"i":null}},"i":{"d":[4,"golden/golden.accounts.repl",66,22,1908,22],"c":"PAY "}},"info":{"d":[50,"golden/golden.accounts.repl",66,21,1907,21],"c":"(PAY sender receiver amount)\n                     "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",67,31,1967,31],"c":"sender "}},{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",67,38,1974,38],"c":"receiver "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",67,47,1983,47],"c":"amount "}},{"var":{"b":3},"i":{"d":[4,"golden/golden.accounts.repl",67,54,1990,54],"c":"date"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",67,22,1958,22],"c":"transfer "}},"info":{"d":[38,"golden/golden.accounts.repl",67,21,1957,21],"c":"(transfer sender receiver amount date)"}}],"type":"*","i":{"d":[38,"golden/golden.accounts.repl",67,21,1957,21],"c":"(transfer sender receiver amount date)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",66,5,1891,5],"c":"with-capability "}},"info":{"d":[106,"golden/golden.accounts.repl",66,4,1890,4],"c":"(with-capability (PAY sender receiver amount)\n                     (transfer sender receiver amount date))"}}],"type":"*","i":{"d":[219,"golden/golden.accounts.repl",64,2,1782,2],"c":"(defun pay (sender:string receiver:string amount:decimal date)\n    \"Demonstrate managed capability PAY\"\n    (with-capability (PAY sender receiver amount)\n                     (transfer sender receiver amount date)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrate managed capability PAY"},"info":{"d":[219,"golden/golden.accounts.repl",64,2,1782,2],"c":"(defun pay (sender:string receiver:string amount:decimal date)\n    \"Demonstrate managed capability PAY\"\n    (with-capability (PAY sender receiver amount)\n                     (transfer sender receiver amount date)))\n\n  "}}},"PAY":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"mgd","type":{"tag":"TypeVar","name":"h","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,21,1556,21],"c":"mgd "}},{"name":"recd","type":{"tag":"TypeVar","name":"i","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,25,1560,25],"c":"recd"}}],"return":{"tag":"TypeVar","name":"g","constraint":[]}},"defName":"manage-PAY","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",61,19,1734,19],"c":"bal "}},{"i":{"d":[3,"golden/golden.accounts.repl",61,23,1738,23],"c":"0.0"},"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",61,16,1731,16],"c":">= "}},"info":{"d":[13,"golden/golden.accounts.repl",61,15,1730,15],"c":"(>= bal 0.0) "}},{"i":{"d":[22,"golden/golden.accounts.repl",61,28,1743,28],"c":"\"insufficient balance\""},"lit":"insufficient balance"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",61,7,1722,7],"c":"enforce "}},"info":{"d":[52,"golden/golden.accounts.repl",61,6,1721,6],"c":"(enforce (>= bal 0.0) \"insufficient balance\")\n      "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",62,6,1773,6],"c":"bal"}}],"type":"*","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}},"pairs":[{"arg":{"name":"bal","type":"decimal","info":{"d":[3,"golden/golden.accounts.repl",60,11,1688,11],"c":"bal"}},"val":{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",60,26,1703,26],"c":"mgd "}},{"var":{"b":1},"i":{"d":[4,"golden/golden.accounts.repl",60,30,1707,30],"c":"recd"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",60,24,1701,24],"c":"- "}},"info":{"d":[12,"golden/golden.accounts.repl",60,23,1700,23],"c":"(- mgd recd)"}}}],"type":"let","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}],"type":"*","i":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrates managed caps, enforces linear constraint on amount."},"info":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"i":{"d":[15,"golden/golden.accounts.repl",54,20,1477,20],"c":"manage-PAY\n    "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,"golden/golden.accounts.repl",52,15,1361,15],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,"golden/golden.accounts.repl",52,29,1375,29],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",52,45,1391,45],"c":"amount"}}],"return":{"tag":"TypeVar","name":"f","constraint":[]}},"defName":"PAY","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[6,"golden/golden.accounts.repl",55,36,1524,36],"c":"sender"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",55,25,1513,25],"c":"USER_GUARD "}},"info":{"d":[19,"golden/golden.accounts.repl",55,24,1512,24],"c":"(USER_GUARD sender)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",55,5,1493,5],"c":"compose-capability "}},"info":{"d":[40,"golden/golden.accounts.repl",55,4,1492,4],"c":"(compose-capability (USER_GUARD sender))"}}],"type":"*","i":{"d":[189,"golden/golden.accounts.repl",52,2,1348,2],"c":"(defcap PAY (sender:string receiver:string amount:decimal)\n    \"Demonstrates managed signature capabilities\"\n    @managed amount manage-PAY\n    (compose-capability (USER_GUARD sender)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrates managed signature capabilities"},"info":{"d":[189,"golden/golden.accounts.repl",52,2,1348,2],"c":"(defcap PAY (sender:string receiver:string amount:decimal)\n    \"Demonstrates managed signature capabilities\"\n    @managed amount manage-PAY\n    (compose-capability (USER_GUARD sender)))\n\n  "}}},"account-keys":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"ac","constraint":[]}},"defName":"account-keys","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",105,22,3023,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",105,21,3022,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",106,12,3042,12],"c":"accounts"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"keys"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",106,7,3037,7],"c":"keys "}},"info":{"d":[15,"golden/golden.accounts.repl",106,6,3036,6],"c":"(keys accounts)"}}],"type":"*","i":{"d":[15,"golden/golden.accounts.repl",106,6,3036,6],"c":"(keys accounts)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",105,5,3006,5],"c":"with-capability "}},"info":{"d":[47,"golden/golden.accounts.repl",105,4,3005,4],"c":"(with-capability (ADMIN)\n      (keys accounts))"}}],"type":"*","i":{"d":[106,"golden/golden.accounts.repl",103,2,2951,2],"c":"(defun account-keys ()\n    \"Get all account keys\"\n    (with-capability (ADMIN)\n      (keys accounts)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Get all account keys"},"info":{"d":[106,"golden/golden.accounts.repl",103,2,2951,2],"c":"(defun account-keys ()\n    \"Get all account keys\"\n    (with-capability (ADMIN)\n      (keys accounts)))\n\n  "}}},"init-escrow":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"bk","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",190,22,5572,22],"c":"deb-acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"bl","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",190,31,5581,31],"c":"amount"}}],"return":{"tag":"TypeVar","name":"bj","constraint":[]}},"defName":"init-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",192,33,5669,33],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",192,22,5658,22],"c":"USER_GUARD "}},"info":{"d":[28,"golden/golden.accounts.repl",192,21,5657,21],"c":"(USER_GUARD deb-acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",193,17,5696,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[9,"golden/golden.accounts.repl",193,26,5705,26],"c":"deb-acct "}},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",195,20,5811,20],"c":"deb-acct "}},{"var":{"b":0},"i":{"d":[10,"golden/golden.accounts.repl",195,29,5820,29],"c":"pact-acct "}},{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",195,39,5830,39],"c":"amount "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",195,47,5838,47],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",195,46,5837,46],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",195,11,5802,11],"c":"transfer "}},"info":{"d":[54,"golden/golden.accounts.repl",195,10,5801,10],"c":"(transfer deb-acct pact-acct amount (get-system-time))"}}],"type":"*","i":{"d":[119,"golden/golden.accounts.repl",194,8,5737,8],"c":"(let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))"}}},"pairs":[{"arg":{"name":"pact-acct","type":{"tag":"TypeVar","name":"bn","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",194,15,5744,15],"c":"pact-acct "}},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",194,43,5772,43],"c":"ESCROW_ACCT "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",194,55,5784,55],"c":"ccy"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":{"tag":"TypeVar","name":"cj","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",231,27,7353,27],"c":"pfx "}},{"name":"ccy","type":{"tag":"TypeVar","name":"ck","constraint":[]},"info":{"d":[3,"golden/golden.accounts.repl",231,31,7357,31],"c":"ccy"}}],"return":{"tag":"TypeVar","name":"ci","constraint":[]}},"defName":"new-pact-account","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",233,14,7414,14],"c":"accounts "}},{"var":{"b":0},"i":{"d":[10,"golden/golden.accounts.repl",233,23,7423,23],"c":"a\n        "}},{"obj":{"amount":{"i":{"d":[12,"golden/golden.accounts.repl",235,20,7470,20],"c":"0.0\n        "},"lit":0},"data":{"obj":{"note":{"i":{"d":[23,"golden/golden.accounts.repl",239,28,7605,28],"c":"\"Created pact account\" "},"lit":"Created pact account"}},"keyorder":["note"],"type":"*","i":{"d":[43,"golden/golden.accounts.repl",239,18,7595,18],"c":"{ \"note\": \"Created pact account\" }\n        "}},"balance":{"i":{"d":[12,"golden/golden.accounts.repl",234,21,7446,21],"c":"0.0\n        "},"lit":0},"ccy":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",236,17,7491,17],"c":"ccy\n        "}},"date":{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",238,19,7560,19],"c":"get-system-time"}},"info":{"d":[26,"golden/golden.accounts.repl",238,18,7559,18],"c":"(get-system-time)\n        "}},"rowguard":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",237,41,7536,41],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"create-pact-guard"}},"i":null}},"i":null}},"i":{"d":[18,"golden/golden.accounts.repl",237,23,7518,23],"c":"create-pact-guard "}},"info":{"d":[32,"golden/golden.accounts.repl",237,22,7517,22],"c":"(create-pact-guard pfx)\n        "}}},"keyorder":["balance","amount","ccy","rowguard","date","data"],"type":"*","i":{"d":[213,"golden/golden.accounts.repl",234,8,7433,8],"c":"{ \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",233,7,7407,7],"c":"insert "}},"info":{"d":[248,"golden/golden.accounts.repl",233,6,7406,6],"c":"(insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      "}},{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",242,6,7654,6],"c":"a"}}],"type":"*","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}},"pairs":[{"arg":{"name":"a","type":{"tag":"TypeVar","name":"cl","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",232,11,7373,11],"c":"a "}},"val":{"args":[{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",232,31,7393,31],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",232,14,7376,14],"c":"get-pact-account "}},"info":{"d":[22,"golden/golden.accounts.repl",232,13,7375,13],"c":"(get-pact-account pfx)"}}}],"type":"let","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}],"type":"*","i":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"i":null}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",194,26,5755,26],"c":"new-pact-account "}},"info":{"d":[34,"golden/golden.accounts.repl",194,25,5754,25],"c":"(new-pact-account ESCROW_ACCT ccy)"}}}],"type":"let","i":{"d":[119,"golden/golden.accounts.repl",194,8,5737,8],"c":"(let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))"}}],"type":"*","i":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}},"pairs":[{"arg":{"name":"ccy","type":{"tag":"TypeVar","name":"bm","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",193,44,5723,44],"c":"ccy "}},"val":{"i":{"d":[4,"golden/golden.accounts.repl",193,37,5716,37],"c":"'ccy"},"lit":"ccy"}}],"type":{"bind":"*"},"i":{"d":[23,"golden/golden.accounts.repl",193,35,5714,35],"c":"{ 'ccy:= ccy }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",193,7,5686,7],"c":"with-read "}},"info":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}],"type":"*","i":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",192,5,5641,5],"c":"with-capability "}},"info":{"d":[218,"golden/golden.accounts.repl",192,4,5640,4],"c":"(with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))))"}}],"type":"*","i":{"d":[311,"golden/golden.accounts.repl",190,2,5552,2],"c":"(defun init-escrow (deb-acct amount)\n    ;; transfer will handle deb-keyset enforce\n    (with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[311,"golden/golden.accounts.repl",190,2,5552,2],"c":"(defun init-escrow (deb-acct amount)\n    ;; transfer will handle deb-keyset enforce\n    (with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))))\n\n  "}}},"create-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"address","type":{"tag":"TypeVar","name":"m","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",69,25,2024,25],"c":"address "}},{"name":"guard","type":{"tag":"TypeVar","name":"n","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",69,33,2032,33],"c":"guard "}},{"name":"ccy","type":{"tag":"TypeVar","name":"o","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",69,39,2038,39],"c":"ccy "}},{"name":"date","type":{"tag":"TypeVar","name":"p","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",69,43,2042,43],"c":"date"}}],"return":{"tag":"TypeVar","name":"l","constraint":[]}},"defName":"create-account","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",70,22,2070,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",70,21,2069,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",71,14,2091,14],"c":"accounts "}},{"var":{"b":0},"i":{"d":[14,"golden/golden.accounts.repl",71,23,2100,23],"c":"address\n      "}},{"obj":{"amount":{"i":{"d":[10,"golden/golden.accounts.repl",73,18,2149,18],"c":"0.0\n      "},"lit":0},"data":{"obj":{"note":{"i":{"d":[18,"golden/golden.accounts.repl",77,26,2245,26],"c":"\"Created account\" "},"lit":"Created account"}},"keyorder":["note"],"type":"*","i":{"d":[36,"golden/golden.accounts.repl",77,16,2235,16],"c":"{ \"note\": \"Created account\" }\n      "}},"balance":{"i":{"d":[10,"golden/golden.accounts.repl",72,19,2127,19],"c":"0.0\n      "},"lit":0},"ccy":{"var":{"b":2},"i":{"d":[10,"golden/golden.accounts.repl",74,15,2168,15],"c":"ccy\n      "}},"date":{"var":{"b":3},"i":{"d":[11,"golden/golden.accounts.repl",76,16,2214,16],"c":"date\n      "}},"rowguard":{"var":{"b":1},"i":{"d":[12,"golden/golden.accounts.repl",75,20,2192,20],"c":"guard\n      "}}},"keyorder":["balance","amount","ccy","rowguard","date","data"],"type":"*","i":{"d":[163,"golden/golden.accounts.repl",72,6,2114,6],"c":"{ \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",71,7,2084,7],"c":"insert "}},"info":{"d":[195,"golden/golden.accounts.repl",71,6,2083,6],"c":"(insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    )"}}],"type":"*","i":{"d":[195,"golden/golden.accounts.repl",71,6,2083,6],"c":"(insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    )"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",70,5,2053,5],"c":"with-capability "}},"info":{"d":[227,"golden/golden.accounts.repl",70,4,2052,4],"c":"(with-capability (ADMIN)\n      (insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    ))"}}],"type":"*","i":{"d":[283,"golden/golden.accounts.repl",69,2,2001,2],"c":"(defun create-account (address guard ccy date)\n    (with-capability (ADMIN)\n      (insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    )))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[283,"golden/golden.accounts.repl",69,2,2001,2],"c":"(defun create-account (address guard ccy date)\n    (with-capability (ADMIN)\n      (insert accounts address\n      { \"balance\": 0.0\n      , \"amount\": 0.0\n      , \"ccy\": ccy\n      , \"rowguard\": guard\n      , \"date\": date\n      , \"data\": { \"note\": \"Created account\" }\n      }\n    )))\n\n  "}}},"USER_GUARD":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"read-all":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"ak","constraint":[]}},"defName":"read-all","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",121,22,3468,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",121,21,3467,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"aa","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",97,29,2795,29],"c":"id"}}],"return":{"tag":"TypeVar","name":"z","constraint":[]}},"defName":"read-account-admin","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"ADMIN","defBody":{"scope":{"list":[{"args":[{"i":{"d":[22,"golden/golden.accounts.repl",50,20,1320,20],"c":"'accounts-admin-keyset"},"lit":"accounts-admin-keyset"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-keyset"}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",50,5,1305,5],"c":"enforce-keyset "}},"info":{"d":[39,"golden/golden.accounts.repl",50,4,1304,4],"c":"(enforce-keyset 'accounts-admin-keyset)"}}],"type":"*","i":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[65,"golden/golden.accounts.repl",49,2,1283,2],"c":"(defcap ADMIN ()\n    (enforce-keyset 'accounts-admin-keyset))\n\n  "}}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",99,22,2867,22],"c":"ADMIN"}},"info":{"d":[14,"golden/golden.accounts.repl",99,21,2866,21],"c":"(ADMIN)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",100,12,2886,12],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",100,21,2895,21],"c":"id "}},{"list":[{"i":{"d":[9,"golden/golden.accounts.repl",100,25,2899,25],"c":"'balance "},"lit":"balance"},{"i":{"d":[5,"golden/golden.accounts.repl",100,34,2908,34],"c":"'ccy "},"lit":"ccy"},{"i":{"d":[10,"golden/golden.accounts.repl",100,39,2913,39],"c":"'rowguard "},"lit":"rowguard"},{"i":{"d":[6,"golden/golden.accounts.repl",100,49,2923,49],"c":"'data "},"lit":"data"},{"i":{"d":[6,"golden/golden.accounts.repl",100,55,2929,55],"c":"'date "},"lit":"date"},{"i":{"d":[7,"golden/golden.accounts.repl",100,61,2935,61],"c":"'amount"},"lit":"amount"}],"type":{"tag":"TypeVar","name":"ab","constraint":[]},"i":{"d":[45,"golden/golden.accounts.repl",100,24,2898,24],"c":"['balance 'ccy 'rowguard 'data 'date 'amount]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",100,7,2881,7],"c":"read "}},"info":{"d":[64,"golden/golden.accounts.repl",100,6,2880,6],"c":"(read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])"}}],"type":"*","i":{"d":[64,"golden/golden.accounts.repl",100,6,2880,6],"c":"(read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",99,5,2850,5],"c":"with-capability "}},"info":{"d":[96,"golden/golden.accounts.repl",99,4,2849,4],"c":"(with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount]))"}}],"type":"*","i":{"d":[183,"golden/golden.accounts.repl",97,2,2768,2],"c":"(defun read-account-admin (id)\n    \"Read data for account ID, admin version\"\n    (with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Read data for account ID, admin version"},"info":{"d":[183,"golden/golden.accounts.repl",97,2,2768,2],"c":"(defun read-account-admin (id)\n    \"Read data for account ID, admin version\"\n    (with-capability (ADMIN)\n      (read accounts id ['balance 'ccy 'rowguard 'data 'date 'amount])))\n\n\n  "}}},"i":null}},"i":{"d":[18,"golden/golden.accounts.repl",122,12,3487,12],"c":"read-account-admin"}},"info":{"d":[21,"golden/golden.accounts.repl",122,11,3486,11],"c":"(read-account-admin) "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",122,38,3513,38],"c":"accounts"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"keys"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",122,33,3508,33],"c":"keys "}},"info":{"d":[15,"golden/golden.accounts.repl",122,32,3507,32],"c":"(keys accounts)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":{"d":[4,"golden/golden.accounts.repl",122,7,3482,7],"c":"map "}},"info":{"d":[42,"golden/golden.accounts.repl",122,6,3481,6],"c":"(map (read-account-admin) (keys accounts))"}}],"type":"*","i":{"d":[42,"golden/golden.accounts.repl",122,6,3481,6],"c":"(map (read-account-admin) (keys accounts))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",121,5,3451,5],"c":"with-capability "}},"info":{"d":[74,"golden/golden.accounts.repl",121,4,3450,4],"c":"(with-capability (ADMIN)\n      (map (read-account-admin) (keys accounts)))"}}],"type":"*","i":{"d":[102,"golden/golden.accounts.repl",120,2,3427,2],"c":"(defun read-all ()\n    (with-capability (ADMIN)\n      (map (read-account-admin) (keys accounts))))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[102,"golden/golden.accounts.repl",120,2,3427,2],"c":"(defun read-all ()\n    (with-capability (ADMIN)\n      (map (read-account-admin) (keys accounts))))\n\n  "}}},"debit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"account":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"manage-PAY":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"mgd","type":{"tag":"TypeVar","name":"h","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,21,1556,21],"c":"mgd "}},{"name":"recd","type":{"tag":"TypeVar","name":"i","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",57,25,1560,25],"c":"recd"}}],"return":{"tag":"TypeVar","name":"g","constraint":[]}},"defName":"manage-PAY","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",61,19,1734,19],"c":"bal "}},{"i":{"d":[3,"golden/golden.accounts.repl",61,23,1738,23],"c":"0.0"},"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",61,16,1731,16],"c":">= "}},"info":{"d":[13,"golden/golden.accounts.repl",61,15,1730,15],"c":"(>= bal 0.0) "}},{"i":{"d":[22,"golden/golden.accounts.repl",61,28,1743,28],"c":"\"insufficient balance\""},"lit":"insufficient balance"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",61,7,1722,7],"c":"enforce "}},"info":{"d":[52,"golden/golden.accounts.repl",61,6,1721,6],"c":"(enforce (>= bal 0.0) \"insufficient balance\")\n      "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",62,6,1773,6],"c":"bal"}}],"type":"*","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}},"pairs":[{"arg":{"name":"bal","type":"decimal","info":{"d":[3,"golden/golden.accounts.repl",60,11,1688,11],"c":"bal"}},"val":{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",60,26,1703,26],"c":"mgd "}},{"var":{"b":1},"i":{"d":[4,"golden/golden.accounts.repl",60,30,1707,30],"c":"recd"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",60,24,1701,24],"c":"- "}},"info":{"d":[12,"golden/golden.accounts.repl",60,23,1700,23],"c":"(- mgd recd)"}}}],"type":"let","i":{"d":[96,"golden/golden.accounts.repl",60,4,1681,4],"c":"(let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal)"}}],"type":"*","i":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Demonstrates managed caps, enforces linear constraint on amount."},"info":{"d":[245,"golden/golden.accounts.repl",57,2,1537,2],"c":"(defun manage-PAY (mgd recd)\n    \"Demonstrates managed caps, enforces linear constraint on amount.\"\n    ;; valid amount handled in transfer\n    (let ((bal:decimal (- mgd recd)))\n      (enforce (>= bal 0.0) \"insufficient balance\")\n      bal))\n\n  "}}},"read-account-user":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"w","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",88,28,2563,28],"c":"id"}}],"return":{"tag":"TypeVar","name":"v","constraint":[]}},"defName":"read-account-user","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[2,"golden/golden.accounts.repl",90,33,2631,33],"c":"id"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",90,22,2620,22],"c":"USER_GUARD "}},"info":{"d":[22,"golden/golden.accounts.repl",90,21,2619,21],"c":"(USER_GUARD id)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",91,17,2652,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[19,"golden/golden.accounts.repl",91,26,2661,26],"c":"id\n                "}},{"body":{"scope":{"list":[{"obj":{"balance":{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",94,21,2747,21],"c":"b"}},"ccy":{"var":{"b":1},"i":{"d":[2,"golden/golden.accounts.repl",94,31,2757,31],"c":"c "}}},"keyorder":["balance","ccy"],"type":"*","i":{"d":[26,"golden/golden.accounts.repl",94,8,2734,8],"c":"{ \"balance\": b, \"ccy\": c }"}}],"type":"*","i":{"d":[120,"golden/golden.accounts.repl",91,6,2641,6],"c":"(with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })"}}},"pairs":[{"arg":{"name":"b","type":{"tag":"TypeVar","name":"x","constraint":[]},"info":{"d":[18,"golden/golden.accounts.repl",92,30,2694,30],"c":"b\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",92,18,2682,18],"c":"\"balance\""},"lit":"balance"}},{"arg":{"name":"c","type":{"tag":"TypeVar","name":"y","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",93,26,2722,26],"c":"c "}},"val":{"i":{"d":[5,"golden/golden.accounts.repl",93,18,2714,18],"c":"\"ccy\""},"lit":"ccy"}}],"type":{"bind":"*"},"i":{"d":[54,"golden/golden.accounts.repl",92,16,2680,16],"c":"{ \"balance\":= b\n                , \"ccy\":= c }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",91,7,2642,7],"c":"with-read "}},"info":{"d":[120,"golden/golden.accounts.repl",91,6,2641,6],"c":"(with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })"}}],"type":"*","i":{"d":[120,"golden/golden.accounts.repl",91,6,2641,6],"c":"(with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",90,5,2603,5],"c":"with-capability "}},"info":{"d":[160,"golden/golden.accounts.repl",90,4,2602,4],"c":"(with-capability (USER_GUARD id)\n      (with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c }))"}}],"type":"*","i":{"d":[231,"golden/golden.accounts.repl",88,2,2537,2],"c":"(defun read-account-user (id)\n    \"Read data for account ID\"\n    (with-capability (USER_GUARD id)\n      (with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Read data for account ID"},"info":{"d":[231,"golden/golden.accounts.repl",88,2,2537,2],"c":"(defun read-account-user (id)\n    \"Read data for account ID\"\n    (with-capability (USER_GUARD id)\n      (with-read accounts id\n                { \"balance\":= b\n                , \"ccy\":= c }\n        { \"balance\": b, \"ccy\": c })))\n\n\n  "}}},"credit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"check-balance":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"two-party-escrow":{"ref":{"defType":"Defpact","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"bg","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",179,29,5215,29],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"bh","constraint":[]},"info":{"d":[39,"golden/golden.accounts.repl",179,38,5224,38],"c":"cred-acct\n                             "}},{"name":"escrow-amount","type":"decimal","info":{"d":[13,"golden/golden.accounts.repl",180,29,5263,29],"c":"escrow-amount"}},{"name":"timeout","type":{"tag":"TypeVar","name":"bi","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",180,51,5285,51],"c":"timeout"}}],"return":{"tag":"TypeVar","name":"bf","constraint":[]}},"defName":"two-party-escrow","defBody":{"scope":{"list":[{"body":{"exec":{"args":[{"var":{"b":0},"i":{"d":[9,"golden/golden.accounts.repl",183,19,5372,19],"c":"deb-acct "}},{"var":{"b":2},"i":{"d":[13,"golden/golden.accounts.repl",183,28,5381,28],"c":"escrow-amount"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"bk","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",190,22,5572,22],"c":"deb-acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"bl","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",190,31,5581,31],"c":"amount"}}],"return":{"tag":"TypeVar","name":"bj","constraint":[]}},"defName":"init-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",192,33,5669,33],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",192,22,5658,22],"c":"USER_GUARD "}},"info":{"d":[28,"golden/golden.accounts.repl",192,21,5657,21],"c":"(USER_GUARD deb-acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",193,17,5696,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[9,"golden/golden.accounts.repl",193,26,5705,26],"c":"deb-acct "}},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",195,20,5811,20],"c":"deb-acct "}},{"var":{"b":0},"i":{"d":[10,"golden/golden.accounts.repl",195,29,5820,29],"c":"pact-acct "}},{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",195,39,5830,39],"c":"amount "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",195,47,5838,47],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",195,46,5837,46],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",195,11,5802,11],"c":"transfer "}},"info":{"d":[54,"golden/golden.accounts.repl",195,10,5801,10],"c":"(transfer deb-acct pact-acct amount (get-system-time))"}}],"type":"*","i":{"d":[119,"golden/golden.accounts.repl",194,8,5737,8],"c":"(let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))"}}},"pairs":[{"arg":{"name":"pact-acct","type":{"tag":"TypeVar","name":"bn","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",194,15,5744,15],"c":"pact-acct "}},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",194,43,5772,43],"c":"ESCROW_ACCT "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",194,55,5784,55],"c":"ccy"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":{"tag":"TypeVar","name":"cj","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",231,27,7353,27],"c":"pfx "}},{"name":"ccy","type":{"tag":"TypeVar","name":"ck","constraint":[]},"info":{"d":[3,"golden/golden.accounts.repl",231,31,7357,31],"c":"ccy"}}],"return":{"tag":"TypeVar","name":"ci","constraint":[]}},"defName":"new-pact-account","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",233,14,7414,14],"c":"accounts "}},{"var":{"b":0},"i":{"d":[10,"golden/golden.accounts.repl",233,23,7423,23],"c":"a\n        "}},{"obj":{"amount":{"i":{"d":[12,"golden/golden.accounts.repl",235,20,7470,20],"c":"0.0\n        "},"lit":0},"data":{"obj":{"note":{"i":{"d":[23,"golden/golden.accounts.repl",239,28,7605,28],"c":"\"Created pact account\" "},"lit":"Created pact account"}},"keyorder":["note"],"type":"*","i":{"d":[43,"golden/golden.accounts.repl",239,18,7595,18],"c":"{ \"note\": \"Created pact account\" }\n        "}},"balance":{"i":{"d":[12,"golden/golden.accounts.repl",234,21,7446,21],"c":"0.0\n        "},"lit":0},"ccy":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",236,17,7491,17],"c":"ccy\n        "}},"date":{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",238,19,7560,19],"c":"get-system-time"}},"info":{"d":[26,"golden/golden.accounts.repl",238,18,7559,18],"c":"(get-system-time)\n        "}},"rowguard":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",237,41,7536,41],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"create-pact-guard"}},"i":null}},"i":null}},"i":{"d":[18,"golden/golden.accounts.repl",237,23,7518,23],"c":"create-pact-guard "}},"info":{"d":[32,"golden/golden.accounts.repl",237,22,7517,22],"c":"(create-pact-guard pfx)\n        "}}},"keyorder":["balance","amount","ccy","rowguard","date","data"],"type":"*","i":{"d":[213,"golden/golden.accounts.repl",234,8,7433,8],"c":"{ \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",233,7,7407,7],"c":"insert "}},"info":{"d":[248,"golden/golden.accounts.repl",233,6,7406,6],"c":"(insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      "}},{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",242,6,7654,6],"c":"a"}}],"type":"*","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}},"pairs":[{"arg":{"name":"a","type":{"tag":"TypeVar","name":"cl","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",232,11,7373,11],"c":"a "}},"val":{"args":[{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",232,31,7393,31],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",232,14,7376,14],"c":"get-pact-account "}},"info":{"d":[22,"golden/golden.accounts.repl",232,13,7375,13],"c":"(get-pact-account pfx)"}}}],"type":"let","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}],"type":"*","i":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"i":null}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",194,26,5755,26],"c":"new-pact-account "}},"info":{"d":[34,"golden/golden.accounts.repl",194,25,5754,25],"c":"(new-pact-account ESCROW_ACCT ccy)"}}}],"type":"let","i":{"d":[119,"golden/golden.accounts.repl",194,8,5737,8],"c":"(let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))"}}],"type":"*","i":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}},"pairs":[{"arg":{"name":"ccy","type":{"tag":"TypeVar","name":"bm","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",193,44,5723,44],"c":"ccy "}},"val":{"i":{"d":[4,"golden/golden.accounts.repl",193,37,5716,37],"c":"'ccy"},"lit":"ccy"}}],"type":{"bind":"*"},"i":{"d":[23,"golden/golden.accounts.repl",193,35,5714,35],"c":"{ 'ccy:= ccy }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",193,7,5686,7],"c":"with-read "}},"info":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}],"type":"*","i":{"d":[172,"golden/golden.accounts.repl",193,6,5685,6],"c":"(with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",192,5,5641,5],"c":"with-capability "}},"info":{"d":[218,"golden/golden.accounts.repl",192,4,5640,4],"c":"(with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time)))))"}}],"type":"*","i":{"d":[311,"golden/golden.accounts.repl",190,2,5552,2],"c":"(defun init-escrow (deb-acct amount)\n    ;; transfer will handle deb-keyset enforce\n    (with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[311,"golden/golden.accounts.repl",190,2,5552,2],"c":"(defun init-escrow (deb-acct amount)\n    ;; transfer will handle deb-keyset enforce\n    (with-capability (USER_GUARD deb-acct)\n      (with-read accounts deb-acct { 'ccy:= ccy }\n        (let ((pact-acct (new-pact-account ESCROW_ACCT ccy)))\n          (transfer deb-acct pact-acct amount (get-system-time))))))\n\n  "}}},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",183,7,5360,7],"c":"init-escrow "}},"info":{"d":[43,"golden/golden.accounts.repl",183,6,5359,6],"c":"(init-escrow deb-acct escrow-amount)\n      "}},"rollback":{"args":[{"var":{"b":3},"i":{"d":[8,"golden/golden.accounts.repl",184,21,5417,21],"c":"timeout "}},{"var":{"b":0},"i":{"d":[9,"golden/golden.accounts.repl",184,29,5425,29],"c":"deb-acct "}},{"var":{"b":1},"i":{"d":[10,"golden/golden.accounts.repl",184,38,5434,38],"c":"cred-acct "}},{"var":{"b":2},"i":{"d":[13,"golden/golden.accounts.repl",184,48,5444,48],"c":"escrow-amount"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"timeout","type":{"tag":"TypeVar","name":"bp","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",197,24,5885,24],"c":"timeout "}},{"name":"deb-acct","type":{"tag":"TypeVar","name":"bq","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",197,32,5893,32],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"br","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",197,41,5902,41],"c":"cred-acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"bs","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",197,51,5912,51],"c":"amount"}}],"return":{"tag":"TypeVar","name":"bo","constraint":[]}},"defName":"cancel-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",198,36,5956,36],"c":"deb-acct "}},{"var":{"b":2},"i":{"d":[10,"golden/golden.accounts.repl",198,45,5965,45],"c":"cred-acct "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",198,55,5975,55],"c":"timeout"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"cb","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",218,25,6788,25],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"cc","constraint":[]},"info":{"d":[10,"golden/golden.accounts.repl",218,34,6797,34],"c":"cred-acct "}},{"name":"timeout","type":{"tag":"TypeVar","name":"cd","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",218,44,6807,44],"c":"timeout"}}],"return":{"tag":"TypeVar","name":"ca","constraint":[]}},"defName":"CANCEL-ESCROW","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"i":{"d":[76,"golden/golden.accounts.repl",222,8,6965,8],"c":"\"Cancel can only be effected by creditor, or debitor after timeout\"\n        "},"lit":"Cancel can only be effected by creditor, or debitor after timeout"},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",223,41,7074,41],"c":"cred-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",223,30,7063,30],"c":"USER_GUARD "}},"info":{"d":[22,"golden/golden.accounts.repl",223,29,7062,29],"c":"(USER_GUARD cred-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",223,10,7043,10],"c":"compose-capability "}},"info":{"d":[53,"golden/golden.accounts.repl",223,9,7042,9],"c":"(compose-capability (USER_GUARD cred-acct))\n         "}},{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",224,46,7132,46],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",224,35,7121,35],"c":"USER_GUARD "}},"info":{"d":[21,"golden/golden.accounts.repl",224,34,7120,34],"c":"(USER_GUARD deb-acct)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",224,15,7101,15],"c":"compose-capability "}},"info":{"d":[57,"golden/golden.accounts.repl",224,14,7100,14],"c":"(compose-capability (USER_GUARD deb-acct))\n              "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",225,27,7170,27],"c":"systime "}},{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",225,35,7178,35],"c":"timeout"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",225,24,7167,24],"c":">= "}},"info":{"d":[21,"golden/golden.accounts.repl",225,23,7166,23],"c":"(>= systime timeout) "}},{"i":{"d":[47,"golden/golden.accounts.repl",225,44,7187,44],"c":"\"Cancel timeout not expired for debitor cancel\""},"lit":"Cancel timeout not expired for debitor cancel"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",225,15,7158,15],"c":"enforce "}},"info":{"d":[78,"golden/golden.accounts.repl",225,14,7157,14],"c":"(enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\")"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"and"}},"i":null}},"i":null}},"i":{"d":[4,"golden/golden.accounts.repl",224,10,7096,10],"c":"and "}},"info":{"d":[150,"golden/golden.accounts.repl",224,9,7095,9],"c":"(and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        "}}],"type":{"tag":"TypeVar","name":"cf","constraint":[]},"i":{"d":[205,"golden/golden.accounts.repl",223,8,7041,8],"c":"[(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-one"}},"i":null}},"i":null}},"i":{"d":[20,"golden/golden.accounts.repl",221,7,6945,7],"c":"enforce-one\n        "}},"info":{"d":[303,"golden/golden.accounts.repl",221,6,6944,6],"c":"(enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])"}}],"type":"*","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}},"pairs":[{"arg":{"name":"systime","type":{"tag":"TypeVar","name":"ce","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",220,11,6910,11],"c":"systime "}},"val":{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",220,20,6919,20],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",220,19,6918,19],"c":"(get-system-time)"}}}],"type":"let","i":{"d":[345,"golden/golden.accounts.repl",220,4,6903,4],"c":"(let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ]))"}}],"type":"*","i":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT"},"info":{"d":[489,"golden/golden.accounts.repl",218,2,6765,2],"c":"(defcap CANCEL-ESCROW (deb-acct cred-acct timeout)\n    \"Capability to cancel an escrow between DEB-ACCT and CRED-ACCT within TIMEOUT\"\n    (let ((systime (get-system-time)))\n      (enforce-one\n        \"Cancel can only be effected by creditor, or debitor after timeout\"\n        [(compose-capability (USER_GUARD cred-acct))\n         (and (compose-capability (USER_GUARD deb-acct))\n              (enforce (>= systime timeout) \"Cancel timeout not expired for debitor cancel\"))\n        ])))\n\n\n  "}}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",198,22,5942,22],"c":"CANCEL-ESCROW "}},"info":{"d":[49,"golden/golden.accounts.repl",198,21,5941,21],"c":"(CANCEL-ESCROW deb-acct cred-acct timeout)\n      "}},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",199,34,6018,34],"c":"ESCROW_ACCT"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",199,17,6001,17],"c":"get-pact-account "}},"info":{"d":[31,"golden/golden.accounts.repl",199,16,6000,16],"c":"(get-pact-account ESCROW_ACCT) "}},{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",199,47,6031,47],"c":"deb-acct "}},{"var":{"b":3},"i":{"d":[7,"golden/golden.accounts.repl",199,56,6040,56],"c":"amount "}},{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",199,64,6048,64],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",199,63,6047,63],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",199,7,5991,7],"c":"transfer "}},"info":{"d":[75,"golden/golden.accounts.repl",199,6,5990,6],"c":"(transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))"}}],"type":"*","i":{"d":[75,"golden/golden.accounts.repl",199,6,5990,6],"c":"(transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",198,5,5925,5],"c":"with-capability "}},"info":{"d":[142,"golden/golden.accounts.repl",198,4,5924,4],"c":"(with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time)))"}}],"type":"*","i":{"d":[209,"golden/golden.accounts.repl",197,2,5863,2],"c":"(defun cancel-escrow (timeout deb-acct cred-acct amount)\n    (with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[209,"golden/golden.accounts.repl",197,2,5863,2],"c":"(defun cancel-escrow (timeout deb-acct cred-acct amount)\n    (with-capability (CANCEL-ESCROW deb-acct cred-acct timeout)\n      (transfer (get-pact-account ESCROW_ACCT) deb-acct amount (get-system-time))))\n\n\n  "}}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",184,7,5403,7],"c":"cancel-escrow "}},"info":{"d":[56,"golden/golden.accounts.repl",184,6,5402,6],"c":"(cancel-escrow timeout deb-acct cred-acct escrow-amount)"}},"entity":null,"info":{"d":[131,"golden/golden.accounts.repl",182,4,5333,4],"c":"(step-with-rollback\n      (init-escrow deb-acct escrow-amount)\n      (cancel-escrow timeout deb-acct cred-acct escrow-amount))\n    "}},"meta":{"model":[],"docs":null},"i":{"d":[131,"golden/golden.accounts.repl",182,4,5333,4],"c":"(step-with-rollback\n      (init-escrow deb-acct escrow-amount)\n      (cancel-escrow timeout deb-acct cred-acct escrow-amount))\n    "}},{"body":{"exec":{"args":[{"var":{"b":0},"i":{"d":[9,"golden/golden.accounts.repl",186,21,5491,21],"c":"deb-acct "}},{"var":{"b":1},"i":{"d":[31,"golden/golden.accounts.repl",186,30,5500,30],"c":"cred-acct\n                     "}},{"var":{"b":2},"i":{"d":[13,"golden/golden.accounts.repl",187,21,5531,21],"c":"escrow-amount"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"bu","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",202,24,6094,24],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"bv","constraint":[]},"info":{"d":[34,"golden/golden.accounts.repl",202,33,6103,33],"c":"cred-acct\n                        "}},{"name":"escrow-amount","type":"decimal","info":{"d":[13,"golden/golden.accounts.repl",203,24,6137,24],"c":"escrow-amount"}}],"return":{"tag":"TypeVar","name":"bt","constraint":[]}},"defName":"finish-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",204,33,6193,33],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",204,22,6182,22],"c":"USER_GUARD "}},"info":{"d":[28,"golden/golden.accounts.repl",204,21,6181,21],"c":"(USER_GUARD deb-acct)\n      "}},{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",205,35,6238,35],"c":"cred-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",205,24,6227,24],"c":"USER_GUARD "}},"info":{"d":[31,"golden/golden.accounts.repl",205,23,6226,23],"c":"(USER_GUARD cred-acct)\n        "}},{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",209,23,6432,23],"c":"escrow-amount "}},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",209,37,6446,37],"c":"price"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",209,20,6429,20],"c":">= "}},"info":{"d":[25,"golden/golden.accounts.repl",209,19,6428,19],"c":"(>= escrow-amount price) "}},{"i":{"d":[27,"golden/golden.accounts.repl",209,44,6453,44],"c":"\"Price cannot negotiate up\""},"lit":"Price cannot negotiate up"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",209,11,6420,11],"c":"enforce "}},"info":{"d":[73,"golden/golden.accounts.repl",209,10,6419,10],"c":"(enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          "}},{"args":[{"var":{"b":0},"i":{"d":[12,"golden/golden.accounts.repl",210,20,6502,20],"c":"escrow-acct "}},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",210,32,6514,32],"c":"cred-acct "}},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",210,42,6524,42],"c":"price "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",210,49,6531,49],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",210,48,6530,48],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",210,11,6493,11],"c":"transfer "}},"info":{"d":[67,"golden/golden.accounts.repl",210,10,6492,10],"c":"(transfer escrow-acct cred-acct price (get-system-time))\n          "}},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",211,17,6566,17],"c":"delta "}},{"i":{"d":[3,"golden/golden.accounts.repl",211,23,6572,23],"c":"0.0"},"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",211,15,6564,15],"c":"> "}},"info":{"d":[26,"golden/golden.accounts.repl",211,14,6563,14],"c":"(> delta 0.0)\n            "}},{"args":[{"var":{"b":0},"i":{"d":[12,"golden/golden.accounts.repl",212,22,6599,22],"c":"escrow-acct "}},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",212,34,6611,34],"c":"deb-acct "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",212,43,6620,43],"c":"delta "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",212,50,6627,50],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",212,49,6626,49],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",212,13,6590,13],"c":"transfer "}},"info":{"d":[68,"golden/golden.accounts.repl",212,12,6589,12],"c":"(transfer escrow-acct deb-acct delta (get-system-time))\n            "}},{"i":{"d":[6,"golden/golden.accounts.repl",213,12,6657,12],"c":"\"noop\""},"lit":"noop"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",211,11,6560,11],"c":"if "}},"info":{"d":[116,"golden/golden.accounts.repl",211,10,6559,10],"c":"(if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          "}},{"args":[{"i":{"d":[48,"golden/golden.accounts.repl",214,18,6683,18],"c":"\"Escrow completed with {} paid and {} refunded\" "},"lit":"Escrow completed with {} paid and {} refunded"},{"list":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",214,67,6732,67],"c":"price "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",214,73,6738,73],"c":"delta"}}],"type":{"tag":"TypeVar","name":"bz","constraint":[]},"i":{"d":[13,"golden/golden.accounts.repl",214,66,6731,66],"c":"[price delta]"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",214,11,6676,11],"c":"format "}},"info":{"d":[81,"golden/golden.accounts.repl",214,10,6675,10],"c":"(format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          "}}],"type":"*","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}},"pairs":[{"arg":{"name":"escrow-acct","type":{"tag":"TypeVar","name":"by","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",208,16,6364,16],"c":"escrow-acct "}},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",208,46,6394,46],"c":"ESCROW_ACCT"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",208,29,6377,29],"c":"get-pact-account "}},"info":{"d":[30,"golden/golden.accounts.repl",208,28,6376,28],"c":"(get-pact-account ESCROW_ACCT)"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":null}},"pairs":[{"arg":{"name":"delta","type":{"tag":"TypeVar","name":"bx","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",207,16,6317,16],"c":"delta "}},"val":{"args":[{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",207,25,6326,25],"c":"escrow-amount "}},{"var":{"b":0},"i":{"d":[5,"golden/golden.accounts.repl",207,39,6340,39],"c":"price"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",207,23,6324,23],"c":"- "}},"info":{"d":[23,"golden/golden.accounts.repl",207,22,6323,22],"c":"(- escrow-amount price)"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":null}},"pairs":[{"arg":{"name":"price","type":{"tag":"TypeVar","name":"bw","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",206,16,6265,16],"c":"price "}},"val":{"args":[{"i":{"d":[13,"golden/golden.accounts.repl",206,36,6285,36],"c":"\"final-price\""},"lit":"final-price"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-decimal"}},"i":null}},"i":{"d":[13,"golden/golden.accounts.repl",206,23,6272,23],"c":"read-decimal "}},"info":{"d":[28,"golden/golden.accounts.repl",206,22,6271,22],"c":"(read-decimal \"final-price\")"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",205,7,6210,7],"c":"with-capability "}},"info":{"d":[549,"golden/golden.accounts.repl",205,6,6209,6],"c":"(with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))"}}],"type":"*","i":{"d":[549,"golden/golden.accounts.repl",205,6,6209,6],"c":"(with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",204,5,6165,5],"c":"with-capability "}},"info":{"d":[595,"golden/golden.accounts.repl",204,4,6164,4],"c":"(with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )))"}}],"type":"*","i":{"d":[693,"golden/golden.accounts.repl",202,2,6072,2],"c":"(defun finish-escrow (deb-acct cred-acct\n                        escrow-amount:decimal)\n    (with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[693,"golden/golden.accounts.repl",202,2,6072,2],"c":"(defun finish-escrow (deb-acct cred-acct\n                        escrow-amount:decimal)\n    (with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))))\n\n\n  "}}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",186,7,5477,7],"c":"finish-escrow "}},"info":{"d":[69,"golden/golden.accounts.repl",186,6,5476,6],"c":"(finish-escrow deb-acct cred-acct\n                     escrow-amount)"}},"rollback":null,"entity":null,"info":{"d":[82,"golden/golden.accounts.repl",185,4,5464,4],"c":"(step\n      (finish-escrow deb-acct cred-acct\n                     escrow-amount))"}},"meta":{"model":[],"docs":null},"i":{"d":[82,"golden/golden.accounts.repl",185,4,5464,4],"c":"(step\n      (finish-escrow deb-acct cred-acct\n                     escrow-amount))"}}],"type":"*","i":{"d":[364,"golden/golden.accounts.repl",179,2,5188,2],"c":"(defpact two-party-escrow (deb-acct cred-acct\n                             escrow-amount:decimal timeout)\n    \"Simple two-party escrow pact\"\n    (step-with-rollback\n      (init-escrow deb-acct escrow-amount)\n      (cancel-escrow timeout deb-acct cred-acct escrow-amount))\n    (step\n      (finish-escrow deb-acct cred-acct\n                     escrow-amount)))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Simple two-party escrow pact"},"info":{"d":[364,"golden/golden.accounts.repl",179,2,5188,2],"c":"(defpact two-party-escrow (deb-acct cred-acct\n                             escrow-amount:decimal timeout)\n    \"Simple two-party escrow pact\"\n    (step-with-rollback\n      (init-escrow deb-acct escrow-amount)\n      (cancel-escrow timeout deb-acct cred-acct escrow-amount))\n    (step\n      (finish-escrow deb-acct cred-acct\n                     escrow-amount)))\n\n\n  "}}},"ESCROW_ACCT":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"TRANSFER":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"transfer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"new-pact-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":{"tag":"TypeVar","name":"cj","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",231,27,7353,27],"c":"pfx "}},{"name":"ccy","type":{"tag":"TypeVar","name":"ck","constraint":[]},"info":{"d":[3,"golden/golden.accounts.repl",231,31,7357,31],"c":"ccy"}}],"return":{"tag":"TypeVar","name":"ci","constraint":[]}},"defName":"new-pact-account","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",233,14,7414,14],"c":"accounts "}},{"var":{"b":0},"i":{"d":[10,"golden/golden.accounts.repl",233,23,7423,23],"c":"a\n        "}},{"obj":{"amount":{"i":{"d":[12,"golden/golden.accounts.repl",235,20,7470,20],"c":"0.0\n        "},"lit":0},"data":{"obj":{"note":{"i":{"d":[23,"golden/golden.accounts.repl",239,28,7605,28],"c":"\"Created pact account\" "},"lit":"Created pact account"}},"keyorder":["note"],"type":"*","i":{"d":[43,"golden/golden.accounts.repl",239,18,7595,18],"c":"{ \"note\": \"Created pact account\" }\n        "}},"balance":{"i":{"d":[12,"golden/golden.accounts.repl",234,21,7446,21],"c":"0.0\n        "},"lit":0},"ccy":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[12,"golden/golden.accounts.repl",236,17,7491,17],"c":"ccy\n        "}},"date":{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",238,19,7560,19],"c":"get-system-time"}},"info":{"d":[26,"golden/golden.accounts.repl",238,18,7559,18],"c":"(get-system-time)\n        "}},"rowguard":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",237,41,7536,41],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"create-pact-guard"}},"i":null}},"i":null}},"i":{"d":[18,"golden/golden.accounts.repl",237,23,7518,23],"c":"create-pact-guard "}},"info":{"d":[32,"golden/golden.accounts.repl",237,22,7517,22],"c":"(create-pact-guard pfx)\n        "}}},"keyorder":["balance","amount","ccy","rowguard","date","data"],"type":"*","i":{"d":[213,"golden/golden.accounts.repl",234,8,7433,8],"c":"{ \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",233,7,7407,7],"c":"insert "}},"info":{"d":[248,"golden/golden.accounts.repl",233,6,7406,6],"c":"(insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      "}},{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",242,6,7654,6],"c":"a"}}],"type":"*","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}},"pairs":[{"arg":{"name":"a","type":{"tag":"TypeVar","name":"cl","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",232,11,7373,11],"c":"a "}},"val":{"args":[{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",232,31,7393,31],"c":"pfx"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",232,14,7376,14],"c":"get-pact-account "}},"info":{"d":[22,"golden/golden.accounts.repl",232,13,7375,13],"c":"(get-pact-account pfx)"}}}],"type":"let","i":{"d":[290,"golden/golden.accounts.repl",232,4,7366,4],"c":"(let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a)"}}],"type":"*","i":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[331,"golden/golden.accounts.repl",231,2,7328,2],"c":"(defun new-pact-account (pfx ccy)\n    (let ((a (get-pact-account pfx)))\n      (insert accounts a\n        { \"balance\": 0.0\n        , \"amount\": 0.0\n        , \"ccy\": ccy\n        , \"rowguard\": (create-pact-guard pfx)\n        , \"date\": (get-system-time)\n        , \"data\": { \"note\": \"Created pact account\" }\n        }\n      )\n      a))\n\n"}}},"get-pact-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"finish-escrow":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"deb-acct","type":{"tag":"TypeVar","name":"bu","constraint":[]},"info":{"d":[9,"golden/golden.accounts.repl",202,24,6094,24],"c":"deb-acct "}},{"name":"cred-acct","type":{"tag":"TypeVar","name":"bv","constraint":[]},"info":{"d":[34,"golden/golden.accounts.repl",202,33,6103,33],"c":"cred-acct\n                        "}},{"name":"escrow-amount","type":"decimal","info":{"d":[13,"golden/golden.accounts.repl",203,24,6137,24],"c":"escrow-amount"}}],"return":{"tag":"TypeVar","name":"bt","constraint":[]}},"defName":"finish-escrow","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",204,33,6193,33],"c":"deb-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",204,22,6182,22],"c":"USER_GUARD "}},"info":{"d":[28,"golden/golden.accounts.repl",204,21,6181,21],"c":"(USER_GUARD deb-acct)\n      "}},{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[9,"golden/golden.accounts.repl",205,35,6238,35],"c":"cred-acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",205,24,6227,24],"c":"USER_GUARD "}},"info":{"d":[31,"golden/golden.accounts.repl",205,23,6226,23],"c":"(USER_GUARD cred-acct)\n        "}},{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",209,23,6432,23],"c":"escrow-amount "}},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",209,37,6446,37],"c":"price"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",209,20,6429,20],"c":">= "}},"info":{"d":[25,"golden/golden.accounts.repl",209,19,6428,19],"c":"(>= escrow-amount price) "}},{"i":{"d":[27,"golden/golden.accounts.repl",209,44,6453,44],"c":"\"Price cannot negotiate up\""},"lit":"Price cannot negotiate up"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",209,11,6420,11],"c":"enforce "}},"info":{"d":[73,"golden/golden.accounts.repl",209,10,6419,10],"c":"(enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          "}},{"args":[{"var":{"b":0},"i":{"d":[12,"golden/golden.accounts.repl",210,20,6502,20],"c":"escrow-acct "}},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",210,32,6514,32],"c":"cred-acct "}},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",210,42,6524,42],"c":"price "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",210,49,6531,49],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",210,48,6530,48],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",210,11,6493,11],"c":"transfer "}},"info":{"d":[67,"golden/golden.accounts.repl",210,10,6492,10],"c":"(transfer escrow-acct cred-acct price (get-system-time))\n          "}},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",211,17,6566,17],"c":"delta "}},{"i":{"d":[3,"golden/golden.accounts.repl",211,23,6572,23],"c":"0.0"},"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",211,15,6564,15],"c":"> "}},"info":{"d":[26,"golden/golden.accounts.repl",211,14,6563,14],"c":"(> delta 0.0)\n            "}},{"args":[{"var":{"b":0},"i":{"d":[12,"golden/golden.accounts.repl",212,22,6599,22],"c":"escrow-acct "}},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",212,34,6611,34],"c":"deb-acct "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",212,43,6620,43],"c":"delta "}},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"get-system-time","defBody":{"scope":{"list":[{"args":[{"i":{"d":[9,"golden/golden.accounts.repl",9,32,304,32],"c":"'curtime "},"lit":"curtime"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"nwrWqW-nekEqE86RWO_mxNuppS6W5MSuKMORAoseYl8","modname":{"namespace":null,"name":"system"},"name":"systbl","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"name":"sysdata","meta":{"model":[],"docs":null},"i":{"d":[35,"golden/golden.accounts.repl",5,2,109,2],"c":"(defschema sysdata curtime:time)\n  "},"fields":[{"name":"curtime","type":"time","info":{"d":[7,"golden/golden.accounts.repl",5,21,128,21],"c":"curtime"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",6,20,162,20],"c":"sysdata"}},"i":{"d":[30,"golden/golden.accounts.repl",6,2,144,2],"c":"(deftable systbl:{sysdata})\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",9,47,319,47],"c":"systbl "}},{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"system"},"arg":{"name":"KEY","type":{"tag":"TypeVar","name":"a","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",7,12,184,12],"c":"KEY "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[5,"golden/golden.accounts.repl",7,16,188,16],"c":"\"sys\""},"lit":"sys"},"eval":{"var":{"direct":{"pdval":"sys"}},"i":null}},"i":{"d":[23,"golden/golden.accounts.repl",7,2,174,2],"c":"(defconst KEY \"sys\")\n  "}}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,54,326,54],"c":"KEY"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",9,42,314,42],"c":"read "}},"info":{"d":[17,"golden/golden.accounts.repl",9,41,313,41],"c":"(read systbl KEY)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",9,29,301,29],"c":"at "}},"info":{"d":[31,"golden/golden.accounts.repl",9,28,300,28],"c":"(at 'curtime (read systbl KEY))"}}],"type":"*","i":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"module":{"namespace":null,"name":"system"},"meta":{"model":[],"docs":null},"info":{"d":[59,"golden/golden.accounts.repl",9,2,274,2],"c":"(defun get-system-time () (at 'curtime (read systbl KEY)))\n"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[15,"golden/golden.accounts.repl",212,50,6627,50],"c":"get-system-time"}},"info":{"d":[17,"golden/golden.accounts.repl",212,49,6626,49],"c":"(get-system-time)"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"src","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,19,2301,19],"c":"src "}},{"name":"dest","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",81,23,2305,23],"c":"dest "}},{"name":"amount","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",81,28,2310,28],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",81,35,2317,35],"c":"date"}}],"return":{"tag":"TypeVar","name":"q","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",83,22,2384,22],"c":"TRANSFER"}},"info":{"d":[17,"golden/golden.accounts.repl",83,21,2383,21],"c":"(TRANSFER)\n      "}},{"list":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",84,13,2407,13],"c":"src "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",84,17,2411,17],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",84,24,2418,24],"c":"date "}},{"obj":{"transfer-to":{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",84,46,2440,46],"c":"dest "}}},"keyorder":["transfer-to"],"type":"*","i":{"d":[23,"golden/golden.accounts.repl",84,29,2423,29],"c":"{ \"transfer-to\": dest }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"at","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,16,4248,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"au","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",147,21,4253,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"av","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",147,28,4260,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"aw","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",147,33,4265,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"as","constraint":[]}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",149,25,4357,25],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",149,24,4356,24],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",149,5,4337,5],"c":"require-capability "}},"info":{"d":[36,"golden/golden.accounts.repl",149,4,4336,4],"c":"(require-capability (TRANSFER))\n    "}},{"args":[{"args":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",150,33,4401,33],"c":"acct"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",43,22,1165,22],"c":"id"}}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"USER_GUARD","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",44,15,1184,15],"c":"accounts "}},{"var":{"b":0},"i":{"d":[3,"golden/golden.accounts.repl",44,24,1193,24],"c":"id "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[1,"golden/golden.accounts.repl",45,30,1246,30],"c":"g"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",45,16,1232,16],"c":"enforce-guard "}},"info":{"d":[17,"golden/golden.accounts.repl",45,15,1231,15],"c":"(enforce-guard g)"}}],"type":"*","i":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":{"d":[2,"golden/golden.accounts.repl",44,43,1212,43],"c":"g "}},"val":{"i":{"d":[11,"golden/golden.accounts.repl",44,29,1198,29],"c":"\"rowguard\" "},"lit":"rowguard"}}],"type":{"bind":"*"},"i":{"d":[35,"golden/golden.accounts.repl",44,27,1196,27],"c":"{ \"rowguard\" := g }\n               "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",44,5,1174,5],"c":"with-read "}},"info":{"d":[76,"golden/golden.accounts.repl",44,4,1173,4],"c":"(with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g))"}}],"type":"*","i":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[109,"golden/golden.accounts.repl",43,2,1145,2],"c":"(defcap USER_GUARD (id)\n    (with-read accounts id { \"rowguard\" := g }\n               (enforce-guard g)))\n\n  "}}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",150,22,4390,22],"c":"USER_GUARD "}},"info":{"d":[24,"golden/golden.accounts.repl",150,21,4389,21],"c":"(USER_GUARD acct)\n      "}},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",151,17,4424,17],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",151,26,4433,26],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",154,23,4517,23],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",154,31,4525,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"balance","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",108,24,3079,24],"c":"balance "}},{"name":"amount","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",108,32,3087,32],"c":"amount"}}],"return":{"tag":"TypeVar","name":"ad","constraint":[]}},"defName":"check-balance","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":{"d":[7,"golden/golden.accounts.repl",109,17,3112,17],"c":"amount "}},{"var":{"b":0},"i":{"d":[7,"golden/golden.accounts.repl",109,24,3119,24],"c":"balance"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",109,14,3109,14],"c":"<= "}},"info":{"d":[20,"golden/golden.accounts.repl",109,13,3108,13],"c":"(<= amount balance) "}},{"i":{"d":[20,"golden/golden.accounts.repl",109,33,3128,33],"c":"\"Insufficient funds\""},"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",109,5,3100,5],"c":"enforce "}},"info":{"d":[50,"golden/golden.accounts.repl",109,4,3099,4],"c":"(enforce (<= amount balance) \"Insufficient funds\")"}}],"type":"*","i":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[97,"golden/golden.accounts.repl",108,2,3057,2],"c":"(defun check-balance (balance amount)\n    (enforce (<= amount balance) \"Insufficient funds\"))\n\n  "}}},"i":null}},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",154,9,4503,9],"c":"check-balance "}},"info":{"d":[39,"golden/golden.accounts.repl",154,8,4502,8],"c":"(check-balance balance amount)\n        "}},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",155,16,4549,16],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",155,25,4558,25],"c":"acct\n                "}},{"obj":{"amount":{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",157,31,4642,31],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",157,29,4640,29],"c":"- "}},"info":{"d":[27,"golden/golden.accounts.repl",157,28,4639,28],"c":"(- amount)\n                "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",159,26,4707,26],"c":"data\n                "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",156,32,4595,32],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",156,40,4603,40],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",156,30,4593,30],"c":"- "}},"info":{"d":[35,"golden/golden.accounts.repl",156,29,4592,29],"c":"(- balance amount)\n                "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",158,26,4676,26],"c":"date\n                "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[161,"golden/golden.accounts.repl",156,16,4579,16],"c":"{ \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",155,9,4542,9],"c":"update "}},"info":{"d":[200,"golden/golden.accounts.repl",155,8,4541,8],"c":"(update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"ax","constraint":[]},"info":{"d":[24,"golden/golden.accounts.repl",152,30,4468,30],"c":"balance\n                "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",152,18,4456,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[48,"golden/golden.accounts.repl",152,16,4454,16],"c":"{ \"balance\":= balance\n                }\n        "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",151,7,4414,7],"c":"with-read "}},"info":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"type":"*","i":{"d":[329,"golden/golden.accounts.repl",151,6,4413,6],"c":"(with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",150,5,4373,5],"c":"with-capability "}},"info":{"d":[371,"golden/golden.accounts.repl",150,4,4372,4],"c":"(with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          )))"}}],"type":"*","i":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Debit AMOUNT from ACCT balance recording DATE and DATA"},"info":{"d":[513,"golden/golden.accounts.repl",147,2,4234,2],"c":"(defun debit (acct amount date data)\n    \"Debit AMOUNT from ACCT balance recording DATE and DATA\"\n    (require-capability (TRANSFER))\n    (with-capability (USER_GUARD acct)\n      (with-read accounts acct\n                { \"balance\":= balance\n                }\n        (check-balance balance amount)\n        (update accounts acct\n                { \"balance\": (- balance amount)\n                , \"amount\": (- amount)\n                , \"date\": date\n                , \"data\": data\n                }\n          ))))\n\n "}}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",84,7,2401,7],"c":"debit "}},"info":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}},{"args":[{"var":{"b":1},"i":{"d":[5,"golden/golden.accounts.repl",85,14,2462,14],"c":"dest "}},{"var":{"b":2},"i":{"d":[7,"golden/golden.accounts.repl",85,19,2467,19],"c":"amount "}},{"var":{"b":3},"i":{"d":[5,"golden/golden.accounts.repl",85,26,2474,26],"c":"date "}},{"obj":{"transfer-from":{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",85,50,2498,50],"c":"src "}}},"keyorder":["transfer-from"],"type":"*","i":{"d":[24,"golden/golden.accounts.repl",85,31,2479,31],"c":"{ \"transfer-from\": src }"}}],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"acct","type":{"tag":"TypeVar","name":"az","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,16,4762,16],"c":"acct "}},{"name":"amount","type":{"tag":"TypeVar","name":"ba","constraint":[]},"info":{"d":[7,"golden/golden.accounts.repl",163,21,4767,21],"c":"amount "}},{"name":"date","type":{"tag":"TypeVar","name":"bb","constraint":[]},"info":{"d":[5,"golden/golden.accounts.repl",163,28,4774,28],"c":"date "}},{"name":"data","type":{"tag":"TypeVar","name":"bc","constraint":[]},"info":{"d":[4,"golden/golden.accounts.repl",163,33,4779,33],"c":"data"}}],"return":{"tag":"TypeVar","name":"ay","constraint":[]}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"TRANSFER","defBody":{"scope":{"list":[{"i":{"d":[4,"golden/golden.accounts.repl",47,22,1274,22],"c":"true"},"lit":true}],"type":"*","i":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[29,"golden/golden.accounts.repl",47,2,1254,2],"c":"(defcap TRANSFER () true)\n\n  "}}},"i":null}},"i":{"d":[8,"golden/golden.accounts.repl",165,24,4868,24],"c":"TRANSFER"}},"info":{"d":[10,"golden/golden.accounts.repl",165,23,4867,23],"c":"(TRANSFER)"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",165,4,4848,4],"c":"require-capability "}},"info":{"d":[37,"golden/golden.accounts.repl",165,3,4847,3],"c":"(require-capability (TRANSFER))\n     "}},{"args":[{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",166,16,4895,16],"c":"accounts "}},{"var":{"b":0},"i":{"d":[21,"golden/golden.accounts.repl",166,25,4904,25],"c":"acct\n                "}},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"HniQBJ-NUJan20k4t6MiqpzhqkSsKmIzN5ef76pcLCU","modname":{"namespace":null,"name":"accounts"},"name":"accounts","meta":{"model":[],"docs":"Main table for accounts module."},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"name":"account","meta":{"model":[],"docs":"Row type for accounts table."},"i":{"d":[173,"golden/golden.accounts.repl",30,2,901,2],"c":"(defschema account\n    \"Row type for accounts table.\"\n     balance:decimal\n     amount:decimal\n     ccy:string\n     rowguard:guard\n     date:time\n     data:object\n     )\n\n  "},"fields":[{"name":"balance","type":"decimal","info":{"d":[7,"golden/golden.accounts.repl",32,5,960,5],"c":"balance"}},{"name":"amount","type":"decimal","info":{"d":[6,"golden/golden.accounts.repl",33,5,981,5],"c":"amount"}},{"name":"ccy","type":"string","info":{"d":[3,"golden/golden.accounts.repl",34,5,1001,5],"c":"ccy"}},{"name":"rowguard","type":{"guard":null},"info":{"d":[8,"golden/golden.accounts.repl",35,5,1017,5],"c":"rowguard"}},{"name":"date","type":"time","info":{"d":[4,"golden/golden.accounts.repl",36,5,1037,5],"c":"date"}},{"name":"data","type":{"schema":"object","type":"*","partial":"full"},"info":{"d":[4,"golden/golden.accounts.repl",37,5,1052,5],"c":"data"}}]}},"i":{"d":[7,"golden/golden.accounts.repl",40,22,1094,22],"c":"account"}},"i":{"d":[71,"golden/golden.accounts.repl",40,2,1074,2],"c":"(deftable accounts:{account}\n    \"Main table for accounts module.\")\n\n  "}}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",168,15,4964,15],"c":"accounts "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",168,24,4973,24],"c":"acct\n              "}},{"obj":{"amount":{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[21,"golden/golden.accounts.repl",170,26,5050,26],"c":"amount\n              "}},"data":{"var":{"f":{"var":{"b":3},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",172,24,5110,24],"c":"data\n              "}},"balance":{"args":[{"var":{"b":0},"i":{"d":[8,"golden/golden.accounts.repl",169,30,5008,30],"c":"balance "}},{"var":{"f":{"var":{"b":1},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",169,38,5016,38],"c":"amount"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",169,28,5006,28],"c":"+ "}},"info":{"d":[33,"golden/golden.accounts.repl",169,27,5005,27],"c":"(+ balance amount)\n              "}},"date":{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[19,"golden/golden.accounts.repl",171,24,5081,24],"c":"date\n              "}}},"keyorder":["balance","amount","date","data"],"type":"*","i":{"d":[145,"golden/golden.accounts.repl",169,14,4992,14],"c":"{ \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      "}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",168,8,4957,8],"c":"update "}},"info":{"d":[182,"golden/golden.accounts.repl",168,7,4956,7],"c":"(update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )"}}],"type":"*","i":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}},"pairs":[{"arg":{"name":"balance","type":{"tag":"TypeVar","name":"bd","constraint":[]},"info":{"d":[8,"golden/golden.accounts.repl",167,30,4939,30],"c":"balance "}},"val":{"i":{"d":[9,"golden/golden.accounts.repl",167,18,4927,18],"c":"\"balance\""},"lit":"balance"}}],"type":{"bind":"*"},"i":{"d":[31,"golden/golden.accounts.repl",167,16,4925,16],"c":"{ \"balance\":= balance }\n       "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":{"d":[10,"golden/golden.accounts.repl",166,6,4885,6],"c":"with-read "}},"info":{"d":[255,"golden/golden.accounts.repl",166,5,4884,5],"c":"(with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      ))"}}],"type":"*","i":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCT balance recording DATE and DATA"},"info":{"d":[398,"golden/golden.accounts.repl",163,1,4747,1],"c":"(defun credit (acct amount date data)\n   \"Credit AMOUNT to ACCT balance recording DATE and DATA\"\n   (require-capability (TRANSFER))\n     (with-read accounts acct\n                { \"balance\":= balance }\n       (update accounts acct\n              { \"balance\": (+ balance amount)\n              , \"amount\": amount\n              , \"date\": date\n              , \"data\": data\n              }\n      )))\n\n\n  "}}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",85,7,2455,7],"c":"credit "}},"info":{"d":[57,"golden/golden.accounts.repl",85,6,2454,6],"c":"(credit dest amount date { \"transfer-from\": src })\n      "}},{"i":{"d":[20,"golden/golden.accounts.repl",86,6,2511,6],"c":"\"Transfer succeeded\""},"lit":"Transfer succeeded"}],"type":"*","i":{"d":[54,"golden/golden.accounts.repl",84,6,2400,6],"c":"(debit src amount date { \"transfer-to\": dest })\n      "}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",83,5,2367,5],"c":"with-capability "}},"info":{"d":[166,"golden/golden.accounts.repl",83,4,2366,4],"c":"(with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\")"}}],"type":"*","i":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":"transfer AMOUNT from SRC to DEST"},"info":{"d":[253,"golden/golden.accounts.repl",81,2,2284,2],"c":"(defun transfer (src dest amount date)\n    \"transfer AMOUNT from SRC to DEST\"\n    (with-capability (TRANSFER)\n      (debit src amount date { \"transfer-to\": dest })\n      (credit dest amount date { \"transfer-from\": src })\n      \"Transfer succeeded\"))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[9,"golden/golden.accounts.repl",212,13,6590,13],"c":"transfer "}},"info":{"d":[68,"golden/golden.accounts.repl",212,12,6589,12],"c":"(transfer escrow-acct deb-acct delta (get-system-time))\n            "}},{"i":{"d":[6,"golden/golden.accounts.repl",213,12,6657,12],"c":"\"noop\""},"lit":"noop"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[3,"golden/golden.accounts.repl",211,11,6560,11],"c":"if "}},"info":{"d":[116,"golden/golden.accounts.repl",211,10,6559,10],"c":"(if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          "}},{"args":[{"i":{"d":[48,"golden/golden.accounts.repl",214,18,6683,18],"c":"\"Escrow completed with {} paid and {} refunded\" "},"lit":"Escrow completed with {} paid and {} refunded"},{"list":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":{"d":[6,"golden/golden.accounts.repl",214,67,6732,67],"c":"price "}},{"var":{"f":{"var":{"b":0},"i":null}},"i":{"d":[5,"golden/golden.accounts.repl",214,73,6738,73],"c":"delta"}}],"type":{"tag":"TypeVar","name":"bz","constraint":[]},"i":{"d":[13,"golden/golden.accounts.repl",214,66,6731,66],"c":"[price delta]"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",214,11,6676,11],"c":"format "}},"info":{"d":[81,"golden/golden.accounts.repl",214,10,6675,10],"c":"(format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          "}}],"type":"*","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}},"pairs":[{"arg":{"name":"escrow-acct","type":{"tag":"TypeVar","name":"by","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",208,16,6364,16],"c":"escrow-acct "}},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"accounts"},"arg":{"name":"ESCROW_ACCT","type":{"tag":"TypeVar","name":"be","constraint":[]},"info":{"d":[12,"golden/golden.accounts.repl",177,12,5155,12],"c":"ESCROW_ACCT "}},"meta":{"model":[],"docs":null},"val":{"raw":{"i":{"d":[16,"golden/golden.accounts.repl",177,24,5167,24],"c":"\"escrow-account\""},"lit":"escrow-account"},"eval":{"var":{"direct":{"pdval":"escrow-account"}},"i":null}},"i":{"d":[43,"golden/golden.accounts.repl",177,2,5145,2],"c":"(defconst ESCROW_ACCT \"escrow-account\")\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[11,"golden/golden.accounts.repl",208,46,6394,46],"c":"ESCROW_ACCT"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"pfx","type":"string","info":{"d":[3,"golden/golden.accounts.repl",229,27,7279,27],"c":"pfx"}}],"return":{"tag":"TypeVar","name":"cg","constraint":[]}},"defName":"get-pact-account","defBody":{"scope":{"list":[{"args":[{"i":{"d":[8,"golden/golden.accounts.repl",229,47,7299,47],"c":"\"{}-{}\" "},"lit":"{}-{}"},{"list":[{"var":{"b":0},"i":{"d":[4,"golden/golden.accounts.repl",229,56,7308,56],"c":"pfx "}},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,61,7313,61],"c":"pact-id"}},"info":{"d":[9,"golden/golden.accounts.repl",229,60,7312,60],"c":"(pact-id)"}}],"type":{"tag":"TypeVar","name":"ch","constraint":[]},"i":{"d":[15,"golden/golden.accounts.repl",229,55,7307,55],"c":"[pfx (pact-id)]"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":{"d":[7,"golden/golden.accounts.repl",229,40,7292,40],"c":"format "}},"info":{"d":[32,"golden/golden.accounts.repl",229,39,7291,39],"c":"(format \"{}-{}\" [pfx (pact-id)])"}}],"type":"*","i":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[74,"golden/golden.accounts.repl",229,2,7254,2],"c":"(defun get-pact-account (pfx:string) (format \"{}-{}\" [pfx (pact-id)]))\n\n  "}}},"i":null}},"i":null}},"i":null}},"i":{"d":[17,"golden/golden.accounts.repl",208,29,6377,29],"c":"get-pact-account "}},"info":{"d":[30,"golden/golden.accounts.repl",208,28,6376,28],"c":"(get-pact-account ESCROW_ACCT)"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":null}},"pairs":[{"arg":{"name":"delta","type":{"tag":"TypeVar","name":"bx","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",207,16,6317,16],"c":"delta "}},"val":{"args":[{"var":{"f":{"var":{"b":2},"i":null}},"i":{"d":[14,"golden/golden.accounts.repl",207,25,6326,25],"c":"escrow-amount "}},{"var":{"b":0},"i":{"d":[5,"golden/golden.accounts.repl",207,39,6340,39],"c":"price"}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":{"d":[2,"golden/golden.accounts.repl",207,23,6324,23],"c":"- "}},"info":{"d":[23,"golden/golden.accounts.repl",207,22,6323,22],"c":"(- escrow-amount price)"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":null}},"pairs":[{"arg":{"name":"price","type":{"tag":"TypeVar","name":"bw","constraint":[]},"info":{"d":[6,"golden/golden.accounts.repl",206,16,6265,16],"c":"price "}},"val":{"args":[{"i":{"d":[13,"golden/golden.accounts.repl",206,36,6285,36],"c":"\"final-price\""},"lit":"final-price"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-decimal"}},"i":null}},"i":{"d":[13,"golden/golden.accounts.repl",206,23,6272,23],"c":"read-decimal "}},"info":{"d":[28,"golden/golden.accounts.repl",206,22,6271,22],"c":"(read-decimal \"final-price\")"}}}],"type":"let","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"type":"*","i":{"d":[500,"golden/golden.accounts.repl",206,8,6257,8],"c":"(let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",205,7,6210,7],"c":"with-capability "}},"info":{"d":[549,"golden/golden.accounts.repl",205,6,6209,6],"c":"(with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))"}}],"type":"*","i":{"d":[549,"golden/golden.accounts.repl",205,6,6209,6],"c":"(with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))"}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":{"d":[16,"golden/golden.accounts.repl",204,5,6165,5],"c":"with-capability "}},"info":{"d":[595,"golden/golden.accounts.repl",204,4,6164,4],"c":"(with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          )))"}}],"type":"*","i":{"d":[693,"golden/golden.accounts.repl",202,2,6072,2],"c":"(defun finish-escrow (deb-acct cred-acct\n                        escrow-amount:decimal)\n    (with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))))\n\n\n  "}}},"module":{"namespace":null,"name":"accounts"},"meta":{"model":[],"docs":null},"info":{"d":[693,"golden/golden.accounts.repl",202,2,6072,2],"c":"(defun finish-escrow (deb-acct cred-acct\n                        escrow-amount:decimal)\n    (with-capability (USER_GUARD deb-acct)\n      (with-capability (USER_GUARD cred-acct)\n        (let* ((price (read-decimal \"final-price\"))\n               (delta (- escrow-amount price))\n               (escrow-acct (get-pact-account ESCROW_ACCT)))\n          (enforce (>= escrow-amount price) \"Price cannot negotiate up\")\n          (transfer escrow-acct cred-acct price (get-system-time))\n          (if (> delta 0.0)\n            (transfer escrow-acct deb-acct delta (get-system-time))\n            \"noop\")\n          (format \"Escrow completed with {} paid and {} refunded\" [price delta])\n          ))))\n\n\n  "}}}}}