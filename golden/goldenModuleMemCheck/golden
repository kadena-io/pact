{"module":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","blessed":[],"interfaces":[],"imports":[],"name":{"namespace":null,"name":"memcheck"},"code":"(module memcheck GOV\n    (defcap GOV () true)\n\n    ; Gas lower for const usage post-fork.\n    (defconst NETWORK_FEE 0.001)\n    (defconst MIN_FEE (+ NETWORK_FEE 0.1))\n    (defconst BANK \"bank\")\n\n    (defschema account-with-nickname\n      balance:decimal\n      nickname:string)\n\n    (defschema account\n      balance:decimal)\n\n    (defschema obj-table\n      name:object)\n\n    (deftable accounts:{account})\n    (deftable accounts-with-longname:{account})\n    (deftable accounts-with-nickname:{account-with-nickname})\n    (deftable objs-table:{obj-table})\n\n    (defun transfer (senderId receiverId amount)\n      \"Send money from sender to receiver, charging a fee\"\n      ;;Read current account information of the sender\n      (with-read accounts senderId {\n        \"balance\":= senderBalance }\n         ;;Read current account information of the receiver\n         (with-read accounts receiverId {\n           \"balance\":= receiverBalance }\n           ;;Update account balance of the sender\n           ;;Charge the sender the fee\n           (update accounts senderId {\n              \"balance\": (- senderBalance (+ amount MIN_FEE)) })\n           ;;Update account balance of the receiver\n           (update accounts receiverId {\n              \"balance\": (+ receiverBalance amount) })\n\n           (with-read accounts BANK {\"balance\" := bankBalance }\n             ;;Collect the fee\n             (update accounts BANK { \"balance\": (+ bankBalance MIN_FEE) })))))\n\n    (defun balance (id)\n      (at \"balance\" (read accounts id [\"balance\"]))\n    )\n\n    (defpact tester ()\n      (step \"dummy step\")\n      (step\n        (yield { \"r\": \"a\" }))\n      (step\n        (resume {\"r\" := res0 }\n         res0))\n      (step\n        (yield { \"g\": \"b\", \"y\": \"b\"}))\n      (step\n        (resume {\"g\" := res3 }\n          res3))\n    )\n\n    (defun lam-test (amount:decimal)\n        (let ((g (lambda (x:decimal) (+ 3.20 x))))\n        (g amount)))\n)\n\n","meta":{"model":[],"docs":null},"governance":{"capability":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOV","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":null},"info":null}}},"refMap":{"NETWORK_FEE":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"NETWORK_FEE","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":1.0e-3},"eval":{"var":{"direct":{"pdval":1.0e-3}},"i":null}},"i":null}},"accounts":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"accounts-with-longname":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts-with-longname","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"accounts-with-nickname":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts-with-nickname","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account-with-nickname","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null},{"name":"nickname","type":"string","info":null}]}},"i":null},"i":null}},"lam-test":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"amount","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"r","constraint":[]}},"defName":"lam-test","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"b":0},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":null},"val":{"amArg":"g","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"i":null,"lit":3.2},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"x","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"s","constraint":[]}}}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":null},"info":null}},"MIN_FEE":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"MIN_FEE","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"args":[{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"NETWORK_FEE","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":1.0e-3},"eval":{"var":{"direct":{"pdval":1.0e-3}},"i":null}},"i":null}},"i":null},{"i":null,"lit":0.1}],"fun":{"var":{"direct":{"pdnat":"+"}},"i":null},"info":null},"eval":{"var":{"direct":{"pdval":0.101}},"i":null}},"i":null}},"account-with-nickname":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account-with-nickname","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null},{"name":"nickname","type":"string","info":null}]}},"balance":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":{"tag":"TypeVar","name":"m","constraint":[]},"info":null}],"return":{"tag":"TypeVar","name":"l","constraint":[]}},"defName":"balance","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"balance"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"list":[{"i":null,"lit":"balance"}],"type":{"tag":"TypeVar","name":"n","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":null},"info":null}},"tester":{"ref":{"defType":"Defpact","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"o","constraint":[]}},"defName":"tester","defBody":{"scope":{"list":[{"body":{"exec":{"i":null,"lit":"dummy step"},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null},{"body":{"exec":{"args":[{"obj":{"r":{"i":null,"lit":"a"}},"keyorder":["r"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"yield"}},"i":null}},"i":null},"info":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null},{"body":{"exec":{"args":[{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"res0","type":{"tag":"TypeVar","name":"p","constraint":[]},"info":null},"val":{"i":null,"lit":"r"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"resume"}},"i":null}},"i":null},"info":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null},{"body":{"exec":{"args":[{"obj":{"g":{"i":null,"lit":"b"},"y":{"i":null,"lit":"b"}},"keyorder":["g","y"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"yield"}},"i":null}},"i":null},"info":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null},{"body":{"exec":{"args":[{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"res3","type":{"tag":"TypeVar","name":"q","constraint":[]},"info":null},"val":{"i":null,"lit":"g"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"resume"}},"i":null}},"i":null},"info":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":null},"info":null}},"account":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"obj-table":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"obj-table","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"name","type":{"schema":"object","type":"*","partial":"full"},"info":null}]}},"objs-table":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"objs-table","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"obj-table","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"name","type":{"schema":"object","type":"*","partial":"full"},"info":null}]}},"i":null},"i":null}},"transfer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"senderId","type":{"tag":"TypeVar","name":"f","constraint":[]},"info":null},{"name":"receiverId","type":{"tag":"TypeVar","name":"g","constraint":[]},"info":null},{"name":"amount","type":{"tag":"TypeVar","name":"h","constraint":[]},"info":null}],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"obj":{"balance":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"MIN_FEE","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"args":[{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"NETWORK_FEE","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":1.0e-3},"eval":{"var":{"direct":{"pdval":1.0e-3}},"i":null}},"i":null}},"i":null},{"i":null,"lit":0.1}],"fun":{"var":{"direct":{"pdnat":"+"}},"i":null},"info":null},"eval":{"var":{"direct":{"pdval":0.101}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}},"keyorder":["balance"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null},{"obj":{"balance":{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}},"keyorder":["balance"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"BANK","type":{"tag":"TypeVar","name":"d","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"bank"},"eval":{"var":{"direct":{"pdval":"bank"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"2849qK-ghtYY9lO3ALof79-o1_8hg9EQ9ipLWYF_AF0","modname":{"namespace":null,"name":"memcheck"},"name":"accounts","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"name":"account","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"balance","type":"decimal","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"BANK","type":{"tag":"TypeVar","name":"d","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"bank"},"eval":{"var":{"direct":{"pdval":"bank"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"obj":{"balance":{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"MIN_FEE","type":{"tag":"TypeVar","name":"c","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"args":[{"var":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"NETWORK_FEE","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":1.0e-3},"eval":{"var":{"direct":{"pdval":1.0e-3}},"i":null}},"i":null}},"i":null},{"i":null,"lit":0.1}],"fun":{"var":{"direct":{"pdnat":"+"}},"i":null},"info":null},"eval":{"var":{"direct":{"pdval":0.101}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}},"keyorder":["balance"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"bankBalance","type":{"tag":"TypeVar","name":"k","constraint":[]},"info":null},"val":{"i":null,"lit":"balance"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"receiverBalance","type":{"tag":"TypeVar","name":"j","constraint":[]},"info":null},"val":{"i":null,"lit":"balance"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"senderBalance","type":{"tag":"TypeVar","name":"i","constraint":[]},"info":null},"val":{"i":null,"lit":"balance"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":"Send money from sender to receiver, charging a fee"},"info":null}},"GOV":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOV","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":null,"name":"memcheck"},"meta":{"model":[],"docs":null},"info":null}},"BANK":{"ref":{"modname":{"namespace":null,"name":"memcheck"},"arg":{"name":"BANK","type":{"tag":"TypeVar","name":"d","constraint":[]},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"bank"},"eval":{"var":{"direct":{"pdval":"bank"}},"i":null}},"i":null}}}}